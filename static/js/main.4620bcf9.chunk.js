(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{232:function(e,t,a){e.exports=a(505)},237:function(e,t,a){},405:function(e,t,a){e.exports=a.p+"static/media/logo.5d5d9eef.svg"},406:function(e,t,a){},505:function(e,t,a){"use strict";a.r(t);var o=a(1),n=a.n(o),l=a(7),c=a.n(l),r=(a(237),a(143)),i=a(213),s=a(214),u=a(229),d=a(215),m=a(89),p=a(228),h=a(216),k=a.n(h),f=a(217),v=a.n(f),E=a(144),g=a(513),y=a(98),B=a(507),b=a(508),x=a(9),w=a(515),I=a(514),S=a(512),N=a(510),C=a(24),D=a(509),T=a(511),R=a(26),j=a.n(R),M=a(140),O=(a(405),a(406),a(407),E.a.SubMenu,g.a.Header),P=g.a.Content,A=(g.a.Footer,g.a.Sider),_=(y.a.Group,new v.a({en:{extID:"Extension ID",extName:"Extension Name",preview:"Generate Preview",extdef:"Extension Define",extimg:"Extension Image",maincolor:"Extension Color",secondcolor:"Parameter Color",menuIcon:"Menu Icon",blockIcon:"Block Icon",addLabel:"Add Label",addInput:"Add String Parameter",addInputNum:"Add Number Parameter",addBool:"Add Boolean Parameter",addblock:"Add Blocks",addBlockFun:"Add Functional Block",addBlockOutput:"Add Output Block",addBlockBool:"Add Boolean Block",addBlockHat:"Add Hat Block",delSure:"delete this block?",uniqBlockId:"* block ID should be unique",uniqBlockName:"* block parameter names should be unique"},zh:{extID:"\u63d2\u4ef6ID",extName:"\u63d2\u4ef6\u540d\u79f0",preview:"\u751f\u6210\u9884\u89c8",extdef:"\u63d2\u4ef6\u5b9a\u4e49",extimg:"\u63d2\u4ef6\u56fe\u6807",maincolor:"\u63d2\u4ef6\u989c\u8272",secondcolor:"\u53d8\u91cf\u989c\u8272",menuIcon:"\u83dc\u5355\u680f\u56fe\u6807",blockIcon:"\u65b9\u5757\u56fe\u6807",addLabel:"\u6dfb\u52a0\u6587\u672c",addInput:"\u6dfb\u52a0\u6587\u672c\u53d8\u91cf",addInputNum:"\u6dfb\u52a0\u6570\u5b57\u53d8\u91cf",addBool:"\u6dfb\u52a0\u5e03\u5c14\u53d8\u91cf",addblock:"\u6dfb\u52a0\u65b9\u5757",addBlockFun:"\u6dfb\u52a0\u51fd\u6570\u65b9\u5757",addBlockOutput:"\u6dfb\u52a0\u8f93\u51fa\u65b9\u5757",addBlockBool:"\u6dfb\u52a0\u5e03\u5c14\u65b9\u5757",addBlockHat:"\u6dfb\u52a0\u5e3d\u5b50\u65b9\u5757",delSure:"\u5220\u9664\u8be5\u65b9\u5757?",uniqBlockId:"* \u79ef\u6728ID\u9700\u8981\u5168\u5c40\u552f\u4e00",uniqBlockName:"* \u79ef\u6728\u53c2\u6570\u540d\u5b57\u9700\u8981\u552f\u4e00"}})),W=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={collapsed:!0,extID:"testExt",extName:"Test",color1Pick:!1,color2Pick:!1,color1:"#0FBD8C",color2:"#0DA57A",menuIcon:null,blockIcon:null,editBlockID:"newblock",blocks:[],menus:[],addBlockType:"",showMutation:!1},k()(Object(m.a)(a),["uploadMenuIcon","uploadBlockIcon","closeMutationModal","generatePreview","addBlockFun","addBlockOutput","addBlockBool","addBlockHat","addLabel","addInput","addInputNum","addBool","applyMutation","injectDeclareWorkspace","makeBlock","editBlock","deleteBlock","saveToJson","loadFromJson"]),a.blockColumn=[{title:"Op Code",dataIndex:"opcode",key:"opcode",width:"20%",render:function(e){return n.a.createElement("a",{href:"javascript:;"},e)}},{title:"Preview",dataIndex:"svg",key:"svg",render:function(e,t){return n.a.createElement("img",{src:"data:image/svg+xml;charset=utf-8,".concat(e)})}},{title:"Action",key:"action",render:function(e,t){return n.a.createElement("span",null,n.a.createElement("a",{href:"#",onClick:function(){return a.editBlock(t.opcode)}},"Edit ",t.name),n.a.createElement(B.a,{type:"vertical"}),n.a.createElement(b.a,{title:_.delSure,onConfirm:function(){return a.deleteBlock(t.opcode)}},n.a.createElement("a",{href:"#"},"Delete")))}}],a}return Object(p.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){this.previewWorkspace=j.a.inject("preview",{media:"./media/",toolbox:'<xml style="display: none">\n<category name="Test" id="testExt" colour="#0FBD8C" secondaryColour="#0DA57A" >\n</category>\n</xml>',zoom:{startScale:.75}}),j.a.Procedures.externalProcedureDefCallback=function(e,t){console.log("externalProcedureDefCallback")},this.previewWorkspace.getFlyout().setRecyclingEnabled(!1),window.ws=this.previewWorkspace}},{key:"uploadMenuIcon",value:function(e){var t=new FileReader,a=this;t.onerror=function(){console.warn("read image file error")},t.onload=function(e){var o=t.result;a.setState({menuIcon:o})},t.readAsDataURL(e)}},{key:"uploadBlockIcon",value:function(e){var t=new FileReader,a=this;t.onerror=function(){console.warn("read image file error")},t.onload=function(e){var o=t.result;a.setState({blockIcon:o})},t.readAsDataURL(e)}},{key:"generatePreview",value:function(){var e=this,t=[];this.previewWorkspace.clear();var a='colour="'.concat(this.state.color1,'" secondaryColour="').concat(this.state.color2,'"'),o="";this.state.menuIcon?o=this.state.menuIcon:this.state.blockIcon&&(o=this.state.blockIcon);var n=[],l=o?'iconURI="'.concat(o,'"'):"";t.push('<xml style="display: none">'),t.push('<category name="'.concat(this.state.extName,'" id="').concat(this.state.extID,'" ').concat(a," ").concat(l,">")),t.push.apply(t,this.state.blocks.map(function(t){var a="".concat(e.state.extID,"_").concat(t.opcode),o=0,l={type:a,category:e.state.extName,colour:e.state.color1,inputsInline:!0,colourSecondary:e.state.color2,extensions:["scratch_extension"]},c=e.state.blockIcon;if(c){l.message0="%1 %2";var r={type:"field_image",src:c,width:40,height:40};l.args0=[r,{type:"field_vertical_separator"}],o+=1}l["message".concat(o)]=t.msg,l["args".concat(o)]=t.args.map(function(e){return e.json}),"func"===t.type?(l.outputShape=3,l.nextStatement=null,l.previousStatement=null):"output"===t.type?(l.outputShape=2,l.output="String",l.checkboxInFlyout=!0):"bool"===t.type&&(l.output="Boolean",l.outputShape=1),n.push(l);var i=t.args.map(function(e){var t=[],a=e.placeholder.replace(/[<"&]/,"_"),o=e.shadowType,n=e.fieldType,l=e.defaultValue||"";return t.push('<value name="'.concat(a,'">')),o&&(t.push('<shadow type="'.concat(o,'">')),t.push('<field name="'.concat(n,'">').concat(l,"</field>")),t.push("</shadow>")),t.push("</value>"),t.join("")});return'<block type="'.concat(a,'">').concat(i.join(""),"</block>")})),t.push("</category>"),t.push("</xml>"),j.a.defineBlocksWithJsonArray(n),console.log("extension",t),this.previewWorkspace.updateToolbox(t.join("\n"))}},{key:"closeMutationModal",value:function(){this.declareWorkspace.clear(),this.setState({showMutation:!1})}},{key:"makeBlock",value:function(e,t){this.mutationRoot=this.declareWorkspace.newBlock("procedures_declaration"),this.mutationRoot.setDeletable(!1),this.mutationRoot.contextMenu=!1,this.mutationRoot.addStringNumberExternal=function(e){j.a.WidgetDiv.hide(!0),e?(this.procCode_=this.procCode_+" %n",this.displayNames_.push("X")):(this.procCode_=this.procCode_+" %s",this.displayNames_.push("TXT")),this.argumentIds_.push(j.a.utils.genUid()),this.argumentDefaults_.push(""),this.updateDisplay_(),this.focusLastEditor_()},t||(t='<xml><mutation proccode="'+j.a.Msg.PROCEDURE_DEFAULT_NAME+'" argumentids="[]" argumentnames="[]" argumentdefaults="[]" warp="false"></mutation></xml>');var a=j.a.Xml.textToDom(t).firstChild;this.mutationRoot.domToMutation(a),this.mutationRoot.initSvg(),this.mutationRoot.render(),"bool"!==e&&"output"!==e||(this.mutationRoot.setPreviousStatement(!1,null),this.mutationRoot.setNextStatement(!1,null),this.mutationRoot.setInputsInline(!0),"output"===e?(this.mutationRoot.setOutputShape(j.a.OUTPUT_SHAPE_ROUND),this.mutationRoot.setOutput(!0,"Boolean")):(this.mutationRoot.setOutputShape(j.a.OUTPUT_SHAPE_HEXAGONAL),this.mutationRoot.setOutput(!0,"Number")));var o=this.mutationRoot.getRelativeToSurfaceXY(),n=o.x,l=o.y,c=180-this.mutationRoot.height/2-l,r=240-this.mutationRoot.width/2-n;this.mutationRoot.moveBy(r,c),window.mu=this.mutationRoot}},{key:"injectDeclareWorkspace",value:function(e){console.log("injectDeclareWorkspace",e),this.blocks=e;var t=j.a.Blocks.defaultToolbox;j.a.Blocks.defaultToolbox=null,this.declareWorkspace=j.a.inject("declare",{media:"./media/"}),j.a.Blocks.defaultToolbox=t;var a=this;this.declareWorkspace.addChangeListener(function(e){a.mutationRoot&&a.mutationRoot.onChangeFn()}),this.makeBlock(this.state.addBlockType)}},{key:"applyMutation",value:function(){var e=this,t=this.mutationRoot.getSvgRoot(),a=t.getBBox();t.removeAttribute("transform");var o=(new XMLSerializer).serializeToString(t);o='<svg id="src" xmlns="http://www.w3.org/2000/svg" width="'.concat(a.width,'" height="').concat(a.height,'" >\n    ').concat(o,"\n    </svg>");var n=this.mutationRoot.mutationToDom(!0),l=JSON.parse(n.getAttribute("argumentnames")),c=[],i=0,s=this.mutationRoot.getProcCode();s=s.split(" ");for(var u=0;u<s.length;u++){var d=s[u];if("%s"===d){var m=l[i],p={placeholder:m,shadowType:"text",fieldType:"TEXT",json:{type:"input_value",name:m}};s[u]="%".concat(i+1),c.push(p),i+=1}else if("%b"===d){var h=l[i],k={placeholder:h,check:"Boolean",json:{type:"input_value",name:h,check:"Boolean"}};s[u]="%".concat(i+1),c.push(k),i+=1}else if("%n"===d){var f=l[i],v={placeholder:f,shadowType:"math_number",fieldType:"NUM",json:{type:"input_value",name:f}};s[u]="%".concat(i+1),c.push(v),i+=1}}var E=s.join(" "),g="<xml>".concat(j.a.Xml.domToText(n),"</xml>"),y={opcode:this.state.editBlockID,svg:o,msg:E,args:c,mutationText:g,type:this.state.addBlockType},B=Object(r.a)(this.state.blocks).filter(function(t){return t.opcode!==e.state.editBlockID});B.push(y),this.setState({showMutation:!1,blocks:B})}},{key:"addLabel",value:function(){this.mutationRoot.addLabelExternal()}},{key:"addInput",value:function(){this.mutationRoot.addStringNumberExternal()}},{key:"addInputNum",value:function(){this.mutationRoot.addStringNumberExternal(!0)}},{key:"addBool",value:function(){this.mutationRoot.addBooleanExternal()}},{key:"addBlockFun",value:function(){this.setState({showMutation:!0,addBlockType:"func"}),this.declareWorkspace&&(this.declareWorkspace.clear(),this.makeBlock())}},{key:"addBlockOutput",value:function(){this.setState({addBlockType:"output",showMutation:!0}),this.declareWorkspace&&(this.declareWorkspace.clear(),this.makeBlock("output"))}},{key:"addBlockBool",value:function(){this.setState({addBlockType:"bool",showMutation:!0}),this.declareWorkspace&&(this.declareWorkspace.clear(),this.makeBlock("bool"))}},{key:"addBlockHat",value:function(){this.setState({addBlockType:"hat",showMutation:!0}),this.declareWorkspace&&(this.declareWorkspace.clear(),this.makeBlock("hat"))}},{key:"editBlock",value:function(e){var t=this.state.blocks.filter(function(t){return t.opcode===e});t&&1==t.length&&(this.declareWorkspace.clear(),this.makeBlock(t[0].type,t[0].mutationText),this.setState({showMutation:!0,addBlockType:t[0].type}))}},{key:"deleteBlock",value:function(e){var t=Object(r.a)(this.state.blocks).filter(function(t){return t.opcode!==e});this.setState({blocks:t})}},{key:"saveToJson",value:function(){var e="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(this.state,2)),t=document.createElement("a");t.setAttribute("href",e),t.setAttribute("download",this.state.extID+".json"),document.body.appendChild(t),t.click(),t.remove()}},{key:"loadFromJson",value:function(e){var t=this;if(e){var a=new FileReader;a.onerror=function(){console.warn("read image file error")},a.onload=function(e){t.setState(Object.assign({},JSON.parse(a.result)))},a.readAsText(e)}}},{key:"render",value:function(){var e=this;return n.a.createElement(g.a,{style:{height:"100vh"}},n.a.createElement(A,{trigger:null,collapsible:!0,collapsed:this.state.collapsed},n.a.createElement("div",{className:"logo"}),n.a.createElement(E.a,{theme:"dark",mode:"inline",defaultSelectedKeys:["1"]},n.a.createElement(E.a.Item,{key:"1"},n.a.createElement(x.a,{type:"plus"}),n.a.createElement("span",null,"New Extension")))),n.a.createElement(g.a,null,n.a.createElement(O,{style:{background:"#fff",padding:0}},n.a.createElement(x.a,{className:"trigger",type:this.state.collapsed?"menu-unfold":"menu-fold",onClick:function(){return e.setState({collapsed:!e.state.collapsed})}})),n.a.createElement(P,{style:{margin:"24px 16px",padding:24,background:"#fff",minHeight:280}},n.a.createElement(w.a,null,n.a.createElement(I.a,{span:14},n.a.createElement(B.a,null,_.extdef),n.a.createElement(w.a,{className:"config-row"},n.a.createElement(I.a,{span:2},n.a.createElement("p",null,_.extID)),n.a.createElement(I.a,{span:3},n.a.createElement(S.a,{value:this.state.extID,onChange:function(t){return e.setState({extID:t.target.value})}})),n.a.createElement(I.a,{span:2,offset:1},n.a.createElement("p",null,_.extName)),n.a.createElement(I.a,{span:3},n.a.createElement(S.a,{value:this.state.extName,onChange:function(t){return e.setState({extName:t.target.value})}}))),n.a.createElement(w.a,{className:"config-row"},n.a.createElement(I.a,{span:2},_.maincolor),n.a.createElement(I.a,{span:3},n.a.createElement("div",{className:"color-display",style:{background:this.state.color1},onClick:function(){return e.setState({color1Pick:!0})}}),this.state.color1Pick?n.a.createElement("div",{style:{position:"absolute",zIndex:"2"}},n.a.createElement("div",{className:"color-cover",onClick:function(){return e.setState({color1Pick:!1})}}),n.a.createElement(M.SketchPicker,{color:this.state.color1,onChange:function(t){return e.setState({color1:t.hex})}})):null),n.a.createElement(I.a,{span:2},_.secondcolor),n.a.createElement(I.a,{span:3},n.a.createElement("div",{className:"color-display",style:{background:this.state.color2},onClick:function(){return e.setState({color2Pick:!0})}}),this.state.color2Pick?n.a.createElement("div",{style:{position:"absolute",zIndex:"2"}},n.a.createElement("div",{className:"color-cover",onClick:function(){return e.setState({color2Pick:!1})}}),n.a.createElement(M.SketchPicker,{color:this.state.color2,onChange:function(t){return e.setState({color2:t.hex})}})):null)),n.a.createElement(B.a,null,_.extimg),n.a.createElement(w.a,{className:"config-row"},n.a.createElement(I.a,{span:4},this.state.menuIcon?n.a.createElement("img",{className:"icon-img",src:this.state.menuIcon}):null,n.a.createElement(N.a,{name:"projheader",accept:".png,.svg",className:"header-uploader",showUploadList:!1,beforeUpload:this.uploadMenuIcon},n.a.createElement(C.a,null,n.a.createElement(x.a,{type:"picture"}),_.menuIcon))),n.a.createElement(I.a,{span:4},this.state.blockIcon?n.a.createElement("img",{className:"icon-img",src:this.state.blockIcon}):null,n.a.createElement(N.a,{name:"projheader",accept:".png,.svg",className:"header-uploader",showUploadList:!1,beforeUpload:this.uploadBlockIcon},n.a.createElement(C.a,null,n.a.createElement(x.a,{type:"picture"}),_.blockIcon)))),n.a.createElement(B.a,null,_.addblock),n.a.createElement(w.a,{className:"btn-wrap"},n.a.createElement(C.a,{onClick:this.addBlockFun},_.addBlockFun),n.a.createElement(C.a,{onClick:this.addBlockOutput},_.addBlockOutput),n.a.createElement(C.a,{onClick:this.addBlockBool},_.addBlockBool),n.a.createElement(C.a,{onClick:this.addBlockHat},_.addBlockHat)),n.a.createElement(B.a,null),n.a.createElement(D.a,{columns:this.blockColumn,dataSource:this.state.blocks})),n.a.createElement(I.a,{span:8,offset:1},n.a.createElement(C.a,{type:"primary",shape:"round",icon:"picture",onClick:this.generatePreview},_.preview),n.a.createElement("div",{id:"preview",style:{height:600,width:480,marginTop:10}}),n.a.createElement(w.a,{className:"btn-wrap"},n.a.createElement(C.a,{onClick:this.saveToJson},"Save"),n.a.createElement(N.a,{name:"jsonUpload",accept:".json",className:"header-uploader",showUploadList:!1,beforeUpload:this.loadFromJson},n.a.createElement(C.a,null,"Open")),n.a.createElement(C.a,{type:"primary"},"Export index.js")))))),n.a.createElement(T.a,{title:"Modify Block",visible:this.state.showMutation,onOk:this.applyMutation,onCancel:this.closeMutationModal},n.a.createElement("div",{id:"declare",style:{width:480,height:360},ref:this.injectDeclareWorkspace}),n.a.createElement("div",{className:"btn-wrap"},n.a.createElement(C.a,{onClick:this.addLabel},_.addLabel),n.a.createElement(C.a,{onClick:this.addInput},_.addInput),n.a.createElement(C.a,{onClick:this.addInputNum},_.addInputNum),n.a.createElement(C.a,{onClick:this.addBool},_.addBool)),n.a.createElement("p",null,_.uniqBlockName),n.a.createElement(B.a,null),n.a.createElement(w.a,null,n.a.createElement(I.a,{span:3},n.a.createElement("p",null,"Block ID")),n.a.createElement(I.a,{span:8},n.a.createElement(S.a,{value:this.state.editBlockID,onChange:function(t){return e.setState({editBlockID:t.target.value})}})),n.a.createElement(I.a,{span:12},n.a.createElement("p",null,_.uniqBlockId)))))}}]),t}(o.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(n.a.createElement(W,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[232,1,2]]]);
//# sourceMappingURL=main.4620bcf9.chunk.js.map