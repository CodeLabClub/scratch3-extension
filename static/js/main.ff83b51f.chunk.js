(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{232:function(e,t,a){e.exports=a(505)},237:function(e,t,a){},405:function(e,t,a){e.exports=a.p+"static/media/logo.5d5d9eef.svg"},406:function(e,t,a){},505:function(e,t,a){"use strict";a.r(t);var o=a(1),n=a.n(o),c=a(7),l=a.n(c),r=(a(237),a(143)),s=a(213),i=a(214),u=a(229),d=a(215),m=a(89),p=a(228),h=a(216),k=a.n(h),f=a(217),g=a.n(f),v=a(144),y=a(513),E=a(98),b=a(507),B=a(508),I=a(9),x=a(515),w=a(514),S=a(512),N=a(510),T=a(24),R=a(509),C=a(511),D=a(26),O=a.n(D),A=a(140),M=(a(405),a(406),a(407),v.a.SubMenu,y.a.Header),j=y.a.Content,P=(y.a.Footer,y.a.Sider),U=(E.a.Group,new g.a({en:{extID:"Extension ID",extName:"Extension Name",preview:"Generate Preview",extdef:"Extension Define",extimg:"Extension Image",maincolor:"Extension Color",secondcolor:"Parameter Color",menuIcon:"Menu Icon",blockIcon:"Block Icon",addLabel:"Add Label",addInput:"Add String Parameter",addInputNum:"Add Number Parameter",addBool:"Add Boolean Parameter",addblock:"Add Blocks",addBlockFun:"Add Functional Block",addBlockOutput:"Add Output Block",addBlockBool:"Add Boolean Block",addBlockHat:"Add Hat Block",delSure:"delete this block?",uniqBlockId:"* block ID should be unique",uniqBlockName:"* block parameter names should be unique"},zh:{extID:"\u63d2\u4ef6ID",extName:"\u63d2\u4ef6\u540d\u79f0",preview:"\u751f\u6210\u9884\u89c8",extdef:"\u63d2\u4ef6\u5b9a\u4e49",extimg:"\u63d2\u4ef6\u56fe\u6807",maincolor:"\u63d2\u4ef6\u989c\u8272",secondcolor:"\u53d8\u91cf\u989c\u8272",menuIcon:"\u83dc\u5355\u680f\u56fe\u6807",blockIcon:"\u65b9\u5757\u56fe\u6807",addLabel:"\u6dfb\u52a0\u6587\u672c",addInput:"\u6dfb\u52a0\u6587\u672c\u53d8\u91cf",addInputNum:"\u6dfb\u52a0\u6570\u5b57\u53d8\u91cf",addBool:"\u6dfb\u52a0\u5e03\u5c14\u53d8\u91cf",addblock:"\u6dfb\u52a0\u65b9\u5757",addBlockFun:"\u6dfb\u52a0\u51fd\u6570\u65b9\u5757",addBlockOutput:"\u6dfb\u52a0\u8f93\u51fa\u65b9\u5757",addBlockBool:"\u6dfb\u52a0\u5e03\u5c14\u65b9\u5757",addBlockHat:"\u6dfb\u52a0\u5e3d\u5b50\u65b9\u5757",delSure:"\u5220\u9664\u8be5\u65b9\u5757?",uniqBlockId:"* \u79ef\u6728ID\u9700\u8981\u5168\u5c40\u552f\u4e00",uniqBlockName:"* \u79ef\u6728\u53c2\u6570\u540d\u5b57\u9700\u8981\u552f\u4e00"}})),_={func:"COMMAND",output:"REPORTER",bool:"BOOLEAN",hat:"HAT"},W=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={collapsed:!0,extID:"testExt",extName:"Test",color1Pick:!1,color2Pick:!1,color1:"#0FBD8C",color2:"#0DA57A",menuIcon:null,blockIcon:null,editBlockID:"newblock",blocks:[],menus:[],addBlockType:"",showMutation:!1},k()(Object(m.a)(a),["uploadMenuIcon","uploadBlockIcon","closeMutationModal","generatePreview","addBlockFun","addBlockOutput","addBlockBool","addBlockHat","addLabel","addInput","addInputNum","addBool","applyMutation","injectDeclareWorkspace","makeBlock","editBlock","deleteBlock","saveToJson","loadFromJson","exportJs"]),a.blockColumn=[{title:"Op Code",dataIndex:"opcode",key:"opcode",width:"20%",render:function(e){return n.a.createElement("a",{href:"javascript:;"},e)}},{title:"Preview",dataIndex:"svg",key:"svg",render:function(e,t){return n.a.createElement("img",{src:"data:image/svg+xml;charset=utf-8,".concat(e)})}},{title:"Action",key:"action",render:function(e,t){return n.a.createElement("span",null,n.a.createElement("a",{href:"#",onClick:function(){return a.editBlock(t.opcode)}},"Edit ",t.name),n.a.createElement(b.a,{type:"vertical"}),n.a.createElement(B.a,{title:U.delSure,onConfirm:function(){return a.deleteBlock(t.opcode)}},n.a.createElement("a",{href:"#"},"Delete")))}}],a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){this.previewWorkspace=O.a.inject("preview",{media:"./media/",toolbox:'<xml style="display: none">\n<category name="Test" id="testExt" colour="#0FBD8C" secondaryColour="#0DA57A" >\n</category>\n</xml>',zoom:{startScale:.75}}),O.a.Procedures.externalProcedureDefCallback=function(e,t){console.log("externalProcedureDefCallback")},this.previewWorkspace.getFlyout().setRecyclingEnabled(!1),window.ws=this.previewWorkspace}},{key:"uploadMenuIcon",value:function(e){var t=new FileReader,a=this;t.onerror=function(){console.warn("read image file error")},t.onload=function(e){var o=t.result;a.setState({menuIcon:o})},t.readAsDataURL(e)}},{key:"uploadBlockIcon",value:function(e){var t=new FileReader,a=this;t.onerror=function(){console.warn("read image file error")},t.onload=function(e){var o=t.result;a.setState({blockIcon:o})},t.readAsDataURL(e)}},{key:"generatePreview",value:function(){var e=this,t=[];this.previewWorkspace.clear();var a='colour="'.concat(this.state.color1,'" secondaryColour="').concat(this.state.color2,'"'),o="";this.state.menuIcon?o=this.state.menuIcon:this.state.blockIcon&&(o=this.state.blockIcon);var n=[],c=o?'iconURI="'.concat(o,'"'):"";t.push('<xml style="display: none">'),t.push('<category name="'.concat(this.state.extName,'" id="').concat(this.state.extID,'" ').concat(a," ").concat(c,">")),t.push.apply(t,this.state.blocks.map(function(t){var a="".concat(e.state.extID,"_").concat(t.opcode),o=0,c={type:a,category:e.state.extName,colour:e.state.color1,inputsInline:!0,colourSecondary:e.state.color2,extensions:["scratch_extension"]},l=e.state.blockIcon;if(l){c.message0="%1 %2";var r={type:"field_image",src:l,width:40,height:40};c.args0=[r,{type:"field_vertical_separator"}],o+=1}c["message".concat(o)]=t.msg,c["args".concat(o)]=t.args.map(function(e){return e.json}),"func"===t.type?(c.outputShape=3,c.nextStatement=null,c.previousStatement=null):"output"===t.type?(c.outputShape=2,c.output="String",c.checkboxInFlyout=!0):"bool"===t.type&&(c.output="Boolean",c.outputShape=1),n.push(c);var s=t.args.map(function(e){var t=[],a=e.placeholder.replace(/[<"&]/,"_"),o=e.shadowType,n=e.fieldType,c=e.defaultValue||"";return t.push('<value name="'.concat(a,'">')),o&&(t.push('<shadow type="'.concat(o,'">')),t.push('<field name="'.concat(n,'">').concat(c,"</field>")),t.push("</shadow>")),t.push("</value>"),t.join("")});return'<block type="'.concat(a,'">').concat(s.join(""),"</block>")})),t.push("</category>"),t.push("</xml>"),O.a.defineBlocksWithJsonArray(n),console.log("extension",t),this.previewWorkspace.updateToolbox(t.join("\n"))}},{key:"closeMutationModal",value:function(){this.declareWorkspace.clear(),this.setState({showMutation:!1})}},{key:"makeBlock",value:function(e,t){this.mutationRoot=this.declareWorkspace.newBlock("procedures_declaration"),this.mutationRoot.setDeletable(!1),this.mutationRoot.contextMenu=!1,this.mutationRoot.addStringNumberExternal=function(e){O.a.WidgetDiv.hide(!0),e?(this.procCode_=this.procCode_+" %n",this.displayNames_.push("X")):(this.procCode_=this.procCode_+" %s",this.displayNames_.push("TXT")),this.argumentIds_.push(O.a.utils.genUid()),this.argumentDefaults_.push(""),this.updateDisplay_(),this.focusLastEditor_()},t||(t='<xml><mutation proccode="'+O.a.Msg.PROCEDURE_DEFAULT_NAME+'" argumentids="[]" argumentnames="[]" argumentdefaults="[]" warp="false"></mutation></xml>');var a=O.a.Xml.textToDom(t).firstChild;this.mutationRoot.domToMutation(a),this.mutationRoot.initSvg(),this.mutationRoot.render(),"bool"!==e&&"output"!==e||(this.mutationRoot.setPreviousStatement(!1,null),this.mutationRoot.setNextStatement(!1,null),this.mutationRoot.setInputsInline(!0),"output"===e?(this.mutationRoot.setOutputShape(O.a.OUTPUT_SHAPE_ROUND),this.mutationRoot.setOutput(!0,"Boolean")):(this.mutationRoot.setOutputShape(O.a.OUTPUT_SHAPE_HEXAGONAL),this.mutationRoot.setOutput(!0,"Number")));var o=this.mutationRoot.getRelativeToSurfaceXY(),n=o.x,c=o.y,l=180-this.mutationRoot.height/2-c,r=240-this.mutationRoot.width/2-n;this.mutationRoot.moveBy(r,l),window.mu=this.mutationRoot}},{key:"injectDeclareWorkspace",value:function(e){this.blocks=e;var t=O.a.Blocks.defaultToolbox;O.a.Blocks.defaultToolbox=null,this.declareWorkspace=O.a.inject("declare",{media:"./media/"}),O.a.Blocks.defaultToolbox=t;var a=this;this.declareWorkspace.addChangeListener(function(e){a.mutationRoot&&a.mutationRoot.onChangeFn()}),this.makeBlock(this.state.addBlockType)}},{key:"applyMutation",value:function(){var e=this,t=this.mutationRoot.getSvgRoot(),a=t.getBBox();t.removeAttribute("transform");var o=(new XMLSerializer).serializeToString(t);o='<svg id="src" xmlns="http://www.w3.org/2000/svg" width="'.concat(a.width,'" height="').concat(a.height,'" >\n    ').concat(o,"\n    </svg>");var n=this.mutationRoot.mutationToDom(!0),c=JSON.parse(n.getAttribute("argumentnames")),l=[],s=0,i=this.mutationRoot.getProcCode();i=i.split(" ");for(var u=0;u<i.length;u++){var d=i[u];if("%s"===d){var m=c[s],p={argType:"STRING",placeholder:m,shadowType:"text",fieldType:"TEXT",json:{type:"input_value",name:m}};i[u]="%".concat(s+1),l.push(p),s+=1}else if("%b"===d){var h=c[s],k={argType:"BOOLEAN",placeholder:h,check:"Boolean",json:{type:"input_value",name:h,check:"Boolean"}};i[u]="%".concat(s+1),l.push(k),s+=1}else if("%n"===d){var f=c[s],g={argType:"NUMBER",placeholder:f,shadowType:"math_number",fieldType:"NUM",json:{type:"input_value",name:f}};i[u]="%".concat(s+1),l.push(g),s+=1}}var v=i.join(" "),y="<xml>".concat(O.a.Xml.domToText(n),"</xml>"),E={opcode:this.state.editBlockID,svg:o,msg:v,args:l,mutationText:y,type:this.state.addBlockType},b=Object(r.a)(this.state.blocks).filter(function(t){return t.opcode!==e.state.editBlockID});b.push(E),this.setState({showMutation:!1,blocks:b})}},{key:"addLabel",value:function(){this.mutationRoot.addLabelExternal()}},{key:"addInput",value:function(){this.mutationRoot.addStringNumberExternal()}},{key:"addInputNum",value:function(){this.mutationRoot.addStringNumberExternal(!0)}},{key:"addBool",value:function(){this.mutationRoot.addBooleanExternal()}},{key:"addBlockFun",value:function(){this.setState({showMutation:!0,addBlockType:"func"}),this.declareWorkspace&&(this.declareWorkspace.clear(),this.makeBlock())}},{key:"addBlockOutput",value:function(){this.setState({addBlockType:"output",showMutation:!0}),this.declareWorkspace&&(this.declareWorkspace.clear(),this.makeBlock("output"))}},{key:"addBlockBool",value:function(){this.setState({addBlockType:"bool",showMutation:!0}),this.declareWorkspace&&(this.declareWorkspace.clear(),this.makeBlock("bool"))}},{key:"addBlockHat",value:function(){this.setState({addBlockType:"hat",showMutation:!0}),this.declareWorkspace&&(this.declareWorkspace.clear(),this.makeBlock("hat"))}},{key:"editBlock",value:function(e){var t=this.state.blocks.filter(function(t){return t.opcode===e});t&&1==t.length&&(this.declareWorkspace.clear(),this.makeBlock(t[0].type,t[0].mutationText),this.setState({showMutation:!0,addBlockType:t[0].type}))}},{key:"deleteBlock",value:function(e){var t=Object(r.a)(this.state.blocks).filter(function(t){return t.opcode!==e});this.setState({blocks:t})}},{key:"saveToJson",value:function(){var e="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(this.state,null,2)),t=document.createElement("a");t.setAttribute("href",e),t.setAttribute("download",this.state.extID+".json"),document.body.appendChild(t),t.click(),t.remove()}},{key:"loadFromJson",value:function(e){var t=this;if(e){var a=new FileReader;a.onerror=function(){console.warn("read image file error")},a.onload=function(e){t.setState(Object.assign({},JSON.parse(a.result)))},a.readAsText(e)}}},{key:"exportJs",value:function(){var e=this.state.extID,t=[],a=[],o=!0,n=!1,c=void 0;try{for(var l,r=this.state.blocks[Symbol.iterator]();!(o=(l=r.next()).done);o=!0){var s=l.value,i=s.msg,u=1,d={opcode:"'".concat(s.opcode,"'"),blockType:"BlockType.".concat(_[s.type])};if(s.args.length){d.arguments={};for(var m=0;m<s.args.length;m++){var p=s.args[m];i=i.replace("%".concat(u),"[".concat(p.json.name,"]")),d.arguments["".concat(p.json.name)]={type:"ArgumentType.".concat(p.argType)},u+=1}}d.text="'".concat(i,"'"),a.push(d),t.push("  ".concat(s.opcode,"(args){\n    \n  }"))}}catch(E){n=!0,c=E}finally{try{o||null==r.return||r.return()}finally{if(n)throw c}}var h=JSON.stringify(a,null,2);h=(h=h.replace(/"/g,"")).replace(/\n/g,"\n      ");var k=this.state.menuIcon?'"'.concat(this.state.menuIcon,'"'):"null",f=this.state.blockIcon?'"'.concat(this.state.blockIcon,'"'):"null",g="\n// create by scratch3-extension generator\nconst ArgumentType = Scratch.ArgumentType;\nconst BlockType = Scratch.BlockType;\nconst formatMessage = Scratch.formatMessage;\nconst log = Scratch.log;\n\nconst menuIconURI = ".concat(k,";\nconst blockIconURI = ").concat(f,";\n\nclass ").concat(e,"{\n  constructor (runtime){\n    this.runtime = runtime;\n  }\n\n  getInfo (){\n    return {\n      id: '").concat(this.state.extID,"',\n      name: '").concat(this.state.extName,"',\n      color1: '").concat(this.state.color1,"',\n      color2: '").concat(this.state.color2,"',\n      menuIconURI: menuIconURI,\n      blockIconURI: blockIconURI,\n      blocks: ").concat(h,"\n    }\n  }\n").concat(t.join("\n"),"\n}\n\nmodule.exports = ").concat(e,";\n");console.log(g);var v="data:text/json;charset=utf-8,"+encodeURIComponent(g),y=document.createElement("a");y.setAttribute("href",v),y.setAttribute("download","index.js"),document.body.appendChild(y),y.click(),y.remove()}},{key:"render",value:function(){var e=this;return n.a.createElement(y.a,{style:{height:"100vh"}},n.a.createElement(P,{trigger:null,collapsible:!0,collapsed:this.state.collapsed},n.a.createElement("div",{className:"logo"}),n.a.createElement(v.a,{theme:"dark",mode:"inline",defaultSelectedKeys:["1"]},n.a.createElement(v.a.Item,{key:"1"},n.a.createElement(I.a,{type:"plus"}),n.a.createElement("span",null,"New Extension")))),n.a.createElement(y.a,null,n.a.createElement(M,{style:{background:"#fff",padding:0}},n.a.createElement(I.a,{className:"trigger",type:this.state.collapsed?"menu-unfold":"menu-fold",onClick:function(){return e.setState({collapsed:!e.state.collapsed})}})),n.a.createElement(j,{style:{margin:"24px 16px",padding:24,background:"#fff",minHeight:280}},n.a.createElement(x.a,null,n.a.createElement(w.a,{span:14},n.a.createElement(b.a,null,U.extdef),n.a.createElement(x.a,{className:"config-row"},n.a.createElement(w.a,{span:2},n.a.createElement("p",null,U.extID)),n.a.createElement(w.a,{span:3},n.a.createElement(S.a,{value:this.state.extID,onChange:function(t){return e.setState({extID:t.target.value})}})),n.a.createElement(w.a,{span:2,offset:1},n.a.createElement("p",null,U.extName)),n.a.createElement(w.a,{span:3},n.a.createElement(S.a,{value:this.state.extName,onChange:function(t){return e.setState({extName:t.target.value})}}))),n.a.createElement(x.a,{className:"config-row"},n.a.createElement(w.a,{span:2},U.maincolor),n.a.createElement(w.a,{span:3},n.a.createElement("div",{className:"color-display",style:{background:this.state.color1},onClick:function(){return e.setState({color1Pick:!0})}}),this.state.color1Pick?n.a.createElement("div",{style:{position:"absolute",zIndex:"2"}},n.a.createElement("div",{className:"color-cover",onClick:function(){return e.setState({color1Pick:!1})}}),n.a.createElement(A.SketchPicker,{color:this.state.color1,onChange:function(t){return e.setState({color1:t.hex})}})):null),n.a.createElement(w.a,{span:2},U.secondcolor),n.a.createElement(w.a,{span:3},n.a.createElement("div",{className:"color-display",style:{background:this.state.color2},onClick:function(){return e.setState({color2Pick:!0})}}),this.state.color2Pick?n.a.createElement("div",{style:{position:"absolute",zIndex:"2"}},n.a.createElement("div",{className:"color-cover",onClick:function(){return e.setState({color2Pick:!1})}}),n.a.createElement(A.SketchPicker,{color:this.state.color2,onChange:function(t){return e.setState({color2:t.hex})}})):null)),n.a.createElement(b.a,null,U.extimg),n.a.createElement(x.a,{className:"config-row"},n.a.createElement(w.a,{span:4},this.state.menuIcon?n.a.createElement("img",{className:"icon-img",src:this.state.menuIcon}):null,n.a.createElement(N.a,{name:"projheader",accept:".png,.svg",className:"header-uploader",showUploadList:!1,beforeUpload:this.uploadMenuIcon},n.a.createElement(T.a,null,n.a.createElement(I.a,{type:"picture"}),U.menuIcon))),n.a.createElement(w.a,{span:4},this.state.blockIcon?n.a.createElement("img",{className:"icon-img",src:this.state.blockIcon}):null,n.a.createElement(N.a,{name:"projheader",accept:".png,.svg",className:"header-uploader",showUploadList:!1,beforeUpload:this.uploadBlockIcon},n.a.createElement(T.a,null,n.a.createElement(I.a,{type:"picture"}),U.blockIcon)))),n.a.createElement(b.a,null,U.addblock),n.a.createElement(x.a,{className:"btn-wrap"},n.a.createElement(T.a,{onClick:this.addBlockFun},U.addBlockFun),n.a.createElement(T.a,{onClick:this.addBlockOutput},U.addBlockOutput),n.a.createElement(T.a,{onClick:this.addBlockBool},U.addBlockBool),n.a.createElement(T.a,{onClick:this.addBlockHat},U.addBlockHat)),n.a.createElement(b.a,null),n.a.createElement(R.a,{columns:this.blockColumn,dataSource:this.state.blocks})),n.a.createElement(w.a,{span:8,offset:1},n.a.createElement(T.a,{type:"primary",shape:"round",icon:"picture",onClick:this.generatePreview},U.preview),n.a.createElement("div",{id:"preview",style:{height:600,width:480,marginTop:10}}),n.a.createElement(x.a,{className:"btn-wrap"},n.a.createElement(T.a,{onClick:this.saveToJson},"Save"),n.a.createElement(N.a,{name:"jsonUpload",accept:".json",className:"header-uploader",showUploadList:!1,beforeUpload:this.loadFromJson},n.a.createElement(T.a,null,"Open")),n.a.createElement(T.a,{type:"primary",onClick:this.exportJs},"Export index.js")))))),n.a.createElement(C.a,{title:"Modify Block",visible:this.state.showMutation,onOk:this.applyMutation,onCancel:this.closeMutationModal},n.a.createElement("div",{id:"declare",style:{width:480,height:360},ref:this.injectDeclareWorkspace}),n.a.createElement("div",{className:"btn-wrap"},n.a.createElement(T.a,{onClick:this.addLabel},U.addLabel),n.a.createElement(T.a,{onClick:this.addInput},U.addInput),n.a.createElement(T.a,{onClick:this.addInputNum},U.addInputNum),n.a.createElement(T.a,{onClick:this.addBool},U.addBool)),n.a.createElement("p",null,U.uniqBlockName),n.a.createElement(b.a,null),n.a.createElement(x.a,null,n.a.createElement(w.a,{span:3},n.a.createElement("p",null,"Block ID")),n.a.createElement(w.a,{span:8},n.a.createElement(S.a,{value:this.state.editBlockID,onChange:function(t){return e.setState({editBlockID:t.target.value})}})),n.a.createElement(w.a,{span:12},n.a.createElement("p",null,U.uniqBlockId)))))}}]),t}(o.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(n.a.createElement(W,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[232,1,2]]]);
//# sourceMappingURL=main.ff83b51f.chunk.js.map