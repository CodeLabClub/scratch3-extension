{"version":3,"sources":["logo.svg","App.js","serviceWorker.js","index.js"],"names":["module","exports","__webpack_require__","p","Header","Menu","SubMenu","Layout","Content","Sider","Footer","strings","Radio","Group","LocalizedStrings","en","extID","extName","preview","extdef","extimg","maincolor","secondcolor","menuIcon","blockIcon","addLabel","addInput","addInputNum","addBool","addblock","addBlockFun","addBlockOutput","addBlockBool","addBlockHat","delSure","uniqBlockId","uniqBlockName","zh","App","props","_this","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","state","collapsed","color1Pick","color2Pick","color1","color2","editBlockID","blocks","menus","addBlockType","showMutation","bindAll","assertThisInitialized","blockColumn","title","dataIndex","key","width","render","text","react_default","a","createElement","href","record","src","concat","onClick","editBlock","opcode","name","divider","type","popconfirm","onConfirm","deleteBlock","previewWorkspace","Blockly","inject","media","toolbox","zoom","startScale","Procedures","externalProcedureDefCallback","mutation","cb","console","log","getFlyout","setRecyclingEnabled","window","ws","file","reader","FileReader","onerror","warn","onload","ev","dataUri","result","setState","readAsDataURL","_this2","xmlParts","clear","colorXML","menuIconURI","blockJsons","menuIconXML","push","apply","map","block","extendedOpcode","argIndex","blockJSON","category","colour","inputsInline","colourSecondary","extensions","iconURI","message0","iconJSON","height","args0","msg","args","arg","json","outputShape","nextStatement","previousStatement","output","checkboxInFlyout","inputXML","inputList","placeholder","replace","shadowType","fieldType","defaultValue","join","defineBlocksWithJsonArray","updateToolbox","declareWorkspace","blockType","mutationText","mutationRoot","newBlock","setDeletable","contextMenu","addStringNumberExternal","isNum","WidgetDiv","hide","procCode_","displayNames_","argumentIds_","utils","genUid","argumentDefaults_","updateDisplay_","focusLastEditor_","Msg","dom","Xml","textToDom","firstChild","domToMutation","initSvg","setPreviousStatement","setNextStatement","setInputsInline","setOutputShape","OUTPUT_SHAPE_ROUND","setOutput","OUTPUT_SHAPE_HEXAGONAL","_this$mutationRoot$ge","getRelativeToSurfaceXY","x","y","dy","dx","moveBy","mu","ref","oldDefaultToolbox","Blocks","defaultToolbox","addChangeListener","evt","onChangeFn","makeBlock","_this3","svg","getSvgRoot","bbox","getBBox","removeAttribute","xml","XMLSerializer","serializeToString","mutationToDom","argNames","JSON","parse","getAttribute","argCnt","proccode","getProcCode","split","n","length","argName","check","domToText","toConsumableArray","filter","blk","addLabelExternal","addBooleanExternal","dataStr","encodeURIComponent","stringify","downloadAnchorNode","document","setAttribute","body","appendChild","click","remove","_this5","assign","readAsText","_this6","layout","style","trigger","collapsible","className","menu","theme","mode","defaultSelectedKeys","Item","icon","background","padding","margin","minHeight","row","col","span","input","value","onChange","e","target","offset","position","zIndex","lib","color","c","hex","upload","accept","showUploadList","beforeUpload","uploadMenuIcon","es_button","uploadBlockIcon","table","columns","dataSource","shape","generatePreview","id","marginTop","saveToJson","loadFromJson","modal","visible","onOk","applyMutation","onCancel","closeMutationModal","injectDeclareWorkspace","Component","Boolean","location","hostname","match","ReactDOM","src_App_0","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"yIAAAA,EAAAC,QAAiBC,EAAAC,EAAuB,0XCYhCC,wBADYC,IAAZC,QACmCC,IAAnCH,QAAQI,EAA2BD,IAA3BC,QAAiBC,GAAUF,IAAlBG,OAAkBH,IAAVE,OAG7BE,GAFeC,IAAMC,MAEX,IAAIC,IAAiB,CACjCC,GAAG,CACDC,MAAO,eACPC,QAAS,iBACTC,QAAS,mBACTC,OAAQ,mBACRC,OAAQ,kBACRC,UAAW,kBACXC,YAAa,kBACbC,SAAU,YACVC,UAAW,aACXC,SAAU,YACVC,SAAU,uBACVC,YAAa,uBACbC,QAAS,wBACTC,SAAU,aACVC,YAAa,uBACbC,eAAgB,mBAChBC,aAAc,oBACdC,YAAa,gBACbC,QAAS,qBACTC,YAAa,8BACbC,cAAe,4CAEjBC,GAAI,CACFrB,MAAO,iBACPC,QAAS,2BACTC,QAAS,2BACTC,OAAQ,2BACRC,OAAQ,2BACRC,UAAW,2BACXC,YAAa,2BACbC,SAAU,iCACVC,UAAW,2BACXC,SAAU,2BACVC,SAAU,uCACVC,YAAa,uCACbC,QAAS,uCACTC,SAAU,2BACVC,YAAa,uCACbC,eAAgB,uCAChBC,aAAc,uCACdC,YAAa,uCACbC,QAAS,kCACTC,YAAa,uDACbC,cAAe,qEA0nBJE,cA5mBb,SAAAA,EAAaC,GAAM,IAAAC,EAAA,OAAAC,OAAAC,EAAA,EAAAD,CAAAE,KAAAL,IACjBE,EAAAC,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAH,GAAAQ,KAAAH,KAAMJ,KACDQ,MAAQ,CACXC,WAAW,EACXhC,MAAO,UACPC,QAAS,OACTgC,YAAY,EACZC,YAAY,EACZC,OAAQ,UACRC,OAAQ,UACR7B,SAAU,KACVC,UAAW,KACX6B,YAAa,WACbC,OAAQ,GACRC,MAAO,GACPC,aAAc,GACdC,cAAc,GAEhBC,IAAQjB,OAAAkB,EAAA,EAAAlB,CAAAD,GAAM,CACZ,iBACA,kBACA,qBACA,kBACA,cACA,iBACA,eACA,cACA,WACA,WACA,cACA,UACA,gBACA,yBACA,YACA,YACA,cACA,aACA,iBAGFA,EAAKoB,YAAc,CAAC,CAClBC,MAAO,UACPC,UAAW,SACXC,IAAK,SACLC,MAAO,MACPC,OAAQ,SAAAC,GAAI,OAAIC,EAAAC,EAAAC,cAAA,KAAGC,KAAK,gBAAgBJ,KACvC,CACDL,MAAO,UACPC,UAAW,MACXC,IAAK,MACLE,OAAQ,SAACC,EAAMK,GAAP,OACNJ,EAAAC,EAAAC,cAAA,OAAKG,IAAG,oCAAAC,OAAsCP,OAE/C,CACDL,MAAO,SACPE,IAAK,SACLE,OAAQ,SAACC,EAAMK,GAAP,OACNJ,EAAAC,EAAAC,cAAA,YACEF,EAAAC,EAAAC,cAAA,KAAGC,KAAK,IAAII,QAAS,kBAAMlC,EAAKmC,UAAUJ,EAAOK,UAAjD,QAAiEL,EAAOM,MACxEV,EAAAC,EAAAC,cAACS,EAAA,EAAD,CAASC,KAAK,aACdZ,EAAAC,EAAAC,cAACW,EAAA,EAAD,CAAYnB,MAAOlD,EAAQuB,QAAS+C,UAAW,kBAAMzC,EAAK0C,YAAYX,EAAOK,UAC3ET,EAAAC,EAAAC,cAAA,KAAGC,KAAK,KAAR,eA7DS9B,mFAqEjBG,KAAKwC,iBAAmBC,IAAQC,OAAO,UAAW,CAChDC,MAAO,WACPC,QAjFY,oIAkFZC,KAAM,CACJC,WAAY,OAIhBL,IAAQM,WAAWC,6BAA+B,SAAUC,EAAUC,GACpEC,QAAQC,IAAI,iCAEdpD,KAAKwC,iBAAiBa,YAAYC,qBAAoB,GACtDC,OAAOC,GAAKxD,KAAKwC,wDAGHiB,GACd,IAAIC,EAAS,IAAIC,WACX9D,EAAQG,KACd0D,EAAOE,QAAU,WACfT,QAAQU,KAAK,0BAGfH,EAAOI,OAAS,SAAUC,GACxB,IAAMC,EAAUN,EAAOO,OACvBpE,EAAMqE,SAAS,CAACtF,SAAUoF,KAE5BN,EAAOS,cAAcV,2CAGNA,GACf,IAAIC,EAAS,IAAIC,WACX9D,EAAQG,KACd0D,EAAOE,QAAU,WACfT,QAAQU,KAAK,0BAGfH,EAAOI,OAAS,SAAUC,GACxB,IAAMC,EAAUN,EAAOO,OACvBpE,EAAMqE,SAAS,CAACrF,UAAWmF,KAE7BN,EAAOS,cAAcV,6CAGL,IAAAW,EAAApE,KACVqE,EAAW,GACjBrE,KAAKwC,iBAAiB8B,QAEtB,IAAMC,EAAQ,WAAAzC,OAAc9B,KAAKI,MAAMI,OAAzB,uBAAAsB,OAAqD9B,KAAKI,MAAMK,OAAhE,KACV+D,EAAc,GACdxE,KAAKI,MAAMxB,SACX4F,EAAcxE,KAAKI,MAAMxB,SAClBoB,KAAKI,MAAMvB,YAClB2F,EAAcxE,KAAKI,MAAMvB,WAE7B,IAAM4F,EAAa,GACbC,EAAcF,EAAW,YAAA1C,OACf0C,EADe,KACE,GACjCH,EAASM,KAAT,+BACAN,EAASM,KAAT,mBAAA7C,OAAiC9B,KAAKI,MAAM9B,QAA5C,UAAAwD,OAA4D9B,KAAKI,MAAM/B,MAAvE,MAAAyD,OAAiFyC,EAAjF,KAAAzC,OAA6F4C,EAA7F,MACAL,EAASM,KAAKC,MAAMP,EAAUrE,KAAKI,MAAMO,OAAOkE,IAAI,SAAAC,GAClD,IAAMC,EAAc,GAAAjD,OAAMsC,EAAKhE,MAAM/B,MAAjB,KAAAyD,OAA0BgD,EAAM7C,QAChD+C,EAAW,EACTC,EAAY,CAChB7C,KAAM2C,EACNG,SAAUd,EAAKhE,MAAM9B,QACrB6G,OAAQf,EAAKhE,MAAMI,OACnB4E,cAAc,EACdC,gBAAiBjB,EAAKhE,MAAMK,OAC5B6E,WAAY,CAAC,sBAETC,EAAUnB,EAAKhE,MAAMvB,UAE3B,GAAI0G,EAAS,CACTN,EAAUO,SAAW,QACrB,IAAMC,EAAW,CACbrD,KAAM,cACNP,IAAK0D,EACLlE,MAAO,GACPqE,OAAQ,IAKZT,EAAUU,MAAQ,CACdF,EAJkB,CAClBrD,KAAM,6BAMV4C,GAAU,EAGdC,EAAS,UAAAnD,OAAWkD,IAAcF,EAAMc,IACxCX,EAAS,OAAAnD,OAAQkD,IAAcF,EAAMe,KAAKhB,IAAI,SAAAiB,GAAG,OAAIA,EAAIC,OAGtC,SAAfjB,EAAM1C,MACR6C,EAAUe,YAvKU,EAwKpBf,EAAUgB,cAAgB,KAC1BhB,EAAUiB,kBAAoB,MACN,WAAfpB,EAAM1C,MACf6C,EAAUe,YA5KS,EA6KnBf,EAAUkB,OAAS,SACnBlB,EAAUmB,kBAAmB,GACL,SAAftB,EAAM1C,OACf6C,EAAUkB,OAAS,UACnBlB,EAAUe,YAlLa,GAqLzBvB,EAAWE,KAAKM,GAChB,IAAMoB,EAAWvB,EAAMe,KAAKhB,IAAI,SAAAiB,GAC9B,IAAMQ,EAAY,GACZC,EAAcT,EAAIS,YAAYC,QAAQ,QAAS,KAC/CC,EAAaX,EAAIW,WACjBC,EAAYZ,EAAIY,UAChBC,EAAeb,EAAIa,cAAgB,GASzC,OARAL,EAAU3B,KAAV,gBAAA7C,OAA+ByE,EAA/B,OACIE,IACFH,EAAU3B,KAAV,iBAAA7C,OAAgC2E,EAAhC,OACAH,EAAU3B,KAAV,gBAAA7C,OAA+B4E,EAA/B,MAAA5E,OAA6C6E,EAA7C,aACAL,EAAU3B,KAAK,cAEjB2B,EAAU3B,KAAK,YAER2B,EAAUM,KAAK,MAGxB,MADY,gBAAA9E,OAAmBiD,EAAnB,MAAAjD,OAAsCuE,EAASO,KAAK,IAApD,eAGdvC,EAASM,KAAK,eACdN,EAASM,KAAT,UACAlC,IAAQoE,0BAA0BpC,GAClCtB,QAAQC,IAAI,YAAaiB,GACzBrE,KAAKwC,iBAAiBsE,cAAczC,EAASuC,KAAK,oDAIlD5G,KAAK+G,iBAAiBzC,QACtBtE,KAAKkE,SAAS,CAACpD,cAAc,sCAGpBkG,EAAWC,GACpBjH,KAAKkH,aAAelH,KAAK+G,iBAAiBI,SAAS,0BAEnDnH,KAAKkH,aAAaE,cAAa,GAC/BpH,KAAKkH,aAAaG,aAAc,EAGhCrH,KAAKkH,aAAaI,wBAA0B,SAASC,GACnD9E,IAAQ+E,UAAUC,MAAK,GACnBF,GACFvH,KAAK0H,UAAY1H,KAAK0H,UAAY,MAClC1H,KAAK2H,cAAchD,KAAK,OAExB3E,KAAK0H,UAAY1H,KAAK0H,UAAY,MAClC1H,KAAK2H,cAAchD,KAAK,QAE1B3E,KAAK4H,aAAajD,KAAKlC,IAAQoF,MAAMC,UACrC9H,KAAK+H,kBAAkBpD,KAAK,IAC5B3E,KAAKgI,iBACLhI,KAAKiI,oBAIFhB,IACHA,EAAe,4BAEGxE,IAAQyF,IAAR,uBAAwC,8FAQ5D,IAAMC,EAAM1F,IAAQ2F,IAAIC,UAAUpB,GAAcqB,WAChDtI,KAAKkH,aAAaqB,cAAcJ,GAChCnI,KAAKkH,aAAasB,UAClBxI,KAAKkH,aAAa5F,SACA,SAAd0F,GAAsC,WAAdA,IAC1BhH,KAAKkH,aAAauB,sBAAqB,EAAO,MAC9CzI,KAAKkH,aAAawB,kBAAiB,EAAO,MAC1C1I,KAAKkH,aAAayB,iBAAgB,GAChB,WAAd3B,GACFhH,KAAKkH,aAAa0B,eAAenG,IAAQoG,oBACzC7I,KAAKkH,aAAa4B,WAAU,EAAM,aAElC9I,KAAKkH,aAAa0B,eAAenG,IAAQsG,wBACzC/I,KAAKkH,aAAa4B,WAAU,EAAM,YA/CL,IAAAE,EAoDlBhJ,KAAKkH,aAAa+B,yBAA1BC,EApD0BF,EAoD1BE,EAAGC,EApDuBH,EAoDvBG,EACJC,EAAM,IAAYpJ,KAAKkH,aAAaxB,OAAS,EAAKyD,EAClDE,EAAM,IAAYrJ,KAAKkH,aAAa7F,MAAQ,EAAK6H,EACvDlJ,KAAKkH,aAAaoC,OAAOD,EAAID,GAC7B7F,OAAOgG,GAAKvJ,KAAKkH,4DAGKsC,GACtBrG,QAAQC,IAAI,yBAA0BoG,GACtCxJ,KAAKW,OAAS6I,EACd,IAAMC,EAAoBhH,IAAQiH,OAAOC,eACzClH,IAAQiH,OAAOC,eAAiB,KAChC3J,KAAK+G,iBAAmBtE,IAAQC,OAAO,UAAW,CAChDC,MAAO,aAETF,IAAQiH,OAAOC,eAAiBF,EAEhC,IAAM5J,EAAQG,KACdA,KAAK+G,iBAAiB6C,kBAAkB,SAASC,GAE3ChK,EAAMqH,cACRrH,EAAMqH,aAAa4C,eAGvB9J,KAAK+J,UAAU/J,KAAKI,MAAMS,sDAGZ,IAAAmJ,EAAAhK,KACRiK,EAAMjK,KAAKkH,aAAagD,aACxBC,EAAOF,EAAIG,UACjBH,EAAII,gBAAgB,aACpB,IAAIC,GAAO,IAAIC,eAAeC,kBAAkBP,GAChDK,EAAG,2DAAAxI,OAA8DqI,EAAK9I,MAAnE,cAAAS,OAAqFqI,EAAKzE,OAA1F,aAAA5D,OACDwI,EADC,gBAIH,IAAMrH,EAAWjD,KAAKkH,aAAauD,eAAc,GAE3CC,EAAWC,KAAKC,MAAM3H,EAAS4H,aAAa,kBAC5ChF,EAAO,GAGTiF,EAAS,EAETC,EAAW/K,KAAKkH,aAAa8D,cACjCD,EAAWA,EAASE,MAAM,KAC1B,IAAK,IAAIC,EAAE,EAAGA,EAAEH,EAASI,OAAQD,IAAI,CACnC,IAAM1N,EAAIuN,EAASG,GACnB,GAAU,OAAN1N,EAAW,CACb,IAAM4N,EAAUV,EAASI,GACnBhF,EAAM,CACVS,YAAa6E,EACb3E,WAAY,OACZC,UAAW,OACXX,KAAM,CAAC3D,KAAM,cAAeF,KAAMkJ,IAEpCL,EAASG,GAAT,IAAApJ,OAAkBgJ,EAAO,GACzBjF,EAAKlB,KAAKmB,GACVgF,GAAQ,OACH,GAAU,OAANtN,EAAW,CACpB,IAAM4N,EAAUV,EAASI,GACnBhF,EAAM,CACVS,YAAa6E,EAGbC,MAAO,UACPtF,KAAM,CAAC3D,KAAM,cAAeF,KAAMkJ,EAASC,MAAO,YAEpDN,EAASG,GAAT,IAAApJ,OAAkBgJ,EAAO,GACzBjF,EAAKlB,KAAKmB,GACVgF,GAAQ,OACH,GAAU,OAANtN,EAAW,CACpB,IAAM4N,EAAUV,EAASI,GACnBhF,EAAM,CACVS,YAAa6E,EACb3E,WAAY,cACZC,UAAW,MACXX,KAAM,CAAC3D,KAAM,cAAeF,KAAMkJ,IAEpCL,EAASG,GAAT,IAAApJ,OAAkBgJ,EAAO,GACzBjF,EAAKlB,KAAKmB,GACVgF,GAAQ,GAIZ,IAAMlF,EAAMmF,EAASnE,KAAK,KACpBK,EAAY,QAAAnF,OAAWW,IAAQ2F,IAAIkD,UAAUrI,GAAjC,UACZkE,EAAW,CACflF,OAAQjC,KAAKI,MAAMM,YACnBuJ,IAAKK,EACL1E,MACAC,OACAoB,aAAcA,EACd7E,KAAMpC,KAAKI,MAAMS,cAEbF,EAASb,OAAAyL,EAAA,EAAAzL,CAAIE,KAAKI,MAAMO,QAAQ6K,OAAO,SAAAC,GAAG,OAAIA,EAAIxJ,SAAW+H,EAAK5J,MAAMM,cAC9EC,EAAOgE,KAAKwC,GAEZnH,KAAKkE,SAAS,CACZpD,cAAc,EACdH,OAAQA,uCAKVX,KAAKkH,aAAawE,sDAGlB1L,KAAKkH,aAAaI,gEAGlBtH,KAAKkH,aAAaI,yBAAwB,qCAG1CtH,KAAKkH,aAAayE,2DAGlB3L,KAAKkE,SAAS,CACZpD,cAAc,EACdD,aAAc,SAEZb,KAAK+G,mBACP/G,KAAK+G,iBAAiBzC,QACtBtE,KAAK+J,sDAMP/J,KAAKkE,SAAS,CACZrD,aAAc,SACdC,cAAc,IAEZd,KAAK+G,mBACP/G,KAAK+G,iBAAiBzC,QACtBtE,KAAK+J,UAAU,kDAKjB/J,KAAKkE,SAAS,CACZrD,aAAc,OACdC,cAAc,IAEZd,KAAK+G,mBACP/G,KAAK+G,iBAAiBzC,QACtBtE,KAAK+J,UAAU,+CAOjB/J,KAAKkE,SAAS,CACZrD,aAAc,MACdC,cAAc,IAEZd,KAAK+G,mBACP/G,KAAK+G,iBAAiBzC,QACtBtE,KAAK+J,UAAU,0CAKR9H,GACT,IAAM6C,EAAQ9E,KAAKI,MAAMO,OAAO6K,OAAO,SAAAC,GAAG,OAAIA,EAAIxJ,SAAWA,IACzD6C,GAAyB,GAAhBA,EAAMqG,SACjBnL,KAAK+G,iBAAiBzC,QACtBtE,KAAK+J,UAAUjF,EAAM,GAAG1C,KAAM0C,EAAM,GAAGmC,cACvCjH,KAAKkE,SAAS,CACZpD,cAAc,EACdD,aAAciE,EAAM,GAAG1C,4CAKhBH,GACX,IAAMtB,EAASb,OAAAyL,EAAA,EAAAzL,CAAIE,KAAKI,MAAMO,QAAQ6K,OAAO,SAAAC,GAAG,OAAIA,EAAIxJ,SAAWA,IACnEjC,KAAKkE,SAAS,CAACvD,gDAIf,IAAMiL,EAAU,gCAAkCC,mBAAmBlB,KAAKmB,UAAU9L,KAAKI,MAAO,IAC1F2L,EAAqBC,SAAStK,cAAc,KAClDqK,EAAmBE,aAAa,OAAYL,GAC5CG,EAAmBE,aAAa,WAAYjM,KAAKI,MAAM/B,MAAQ,SAC/D2N,SAASE,KAAKC,YAAYJ,GAC1BA,EAAmBK,QACnBL,EAAmBM,8CAGP5I,GAAK,IAAA6I,EAAAtM,KACjB,GAAIyD,EAAK,CACP,IAAIC,EAAS,IAAIC,WAEjBD,EAAOE,QAAU,WACbT,QAAQU,KAAK,0BAEjBH,EAAOI,OAAS,SAAAC,GACduI,EAAKpI,SAASpE,OAAOyM,OAAO,GAC1B5B,KAAKC,MAAMlH,EAAOO,WAGtBP,EAAO8I,WAAW/I,qCAIb,IAAAgJ,EAAAzM,KACP,OACEwB,EAAAC,EAAAC,cAACgL,EAAA,EAAD,CAAQC,MAAO,CAACjH,OAAQ,UACtBlE,EAAAC,EAAAC,cAAC5D,EAAD,CACE8O,QAAS,KACTC,aAAW,EACXxM,UAAWL,KAAKI,MAAMC,WAEtBmB,EAAAC,EAAAC,cAAA,OAAKoL,UAAU,SACftL,EAAAC,EAAAC,cAACqL,EAAA,EAAD,CAAMC,MAAM,OAAOC,KAAK,SAASC,oBAAqB,CAAC,MACrD1L,EAAAC,EAAAC,cAACqL,EAAA,EAAKI,KAAN,CAAW/L,IAAI,KACbI,EAAAC,EAAAC,cAAC0L,EAAA,EAAD,CAAMhL,KAAK,SACXZ,EAAAC,EAAAC,cAAA,gCAINF,EAAAC,EAAAC,cAACgL,EAAA,EAAD,KACElL,EAAAC,EAAAC,cAACjE,EAAD,CAAQkP,MAAO,CAAEU,WAAY,OAAQC,QAAS,IAC5C9L,EAAAC,EAAAC,cAAC0L,EAAA,EAAD,CACEN,UAAU,UACV1K,KAAMpC,KAAKI,MAAMC,UAAY,cAAgB,YAC7C0B,QAAS,kBAAM0K,EAAKvI,SAAS,CAAC7D,WAAYoM,EAAKrM,MAAMC,gBAGzDmB,EAAAC,EAAAC,cAAC7D,EAAD,CAAS8O,MAAO,CACdY,OAAQ,YAAaD,QAAS,GAAID,WAAY,OAAQG,UAAW,MAGjEhM,EAAAC,EAAAC,cAAC+L,EAAA,EAAD,KACEjM,EAAAC,EAAAC,cAACgM,EAAA,EAAD,CAAKC,KAAM,IACTnM,EAAAC,EAAAC,cAACS,EAAA,EAAD,KAAUnE,EAAQQ,QAClBgD,EAAAC,EAAAC,cAAC+L,EAAA,EAAD,CAAKX,UAAU,cACbtL,EAAAC,EAAAC,cAACgM,EAAA,EAAD,CAAKC,KAAM,GACTnM,EAAAC,EAAAC,cAAA,SAAI1D,EAAQK,QAEdmD,EAAAC,EAAAC,cAACgM,EAAA,EAAD,CAAKC,KAAM,GACTnM,EAAAC,EAAAC,cAACkM,EAAA,EAAD,CAAOC,MAAO7N,KAAKI,MAAM/B,MAAOyP,SAAU,SAAAC,GAAC,OAAItB,EAAKvI,SAAS,CAAC7F,MAAO0P,EAAEC,OAAOH,YAEhFrM,EAAAC,EAAAC,cAACgM,EAAA,EAAD,CAAKC,KAAM,EAAGM,OAAQ,GACpBzM,EAAAC,EAAAC,cAAA,SAAI1D,EAAQM,UAEdkD,EAAAC,EAAAC,cAACgM,EAAA,EAAD,CAAKC,KAAM,GACTnM,EAAAC,EAAAC,cAACkM,EAAA,EAAD,CAAOC,MAAO7N,KAAKI,MAAM9B,QAASwP,SAAU,SAAAC,GAAC,OAAItB,EAAKvI,SAAS,CAAC5F,QAASyP,EAAEC,OAAOH,aAGtFrM,EAAAC,EAAAC,cAAC+L,EAAA,EAAD,CAAKX,UAAU,cACbtL,EAAAC,EAAAC,cAACgM,EAAA,EAAD,CAAKC,KAAM,GAAI3P,EAAQU,WACvB8C,EAAAC,EAAAC,cAACgM,EAAA,EAAD,CAAKC,KAAM,GACTnM,EAAAC,EAAAC,cAAA,OAAKoL,UAAU,gBAAgBH,MAAO,CAACU,WAAYrN,KAAKI,MAAMI,QAASuB,QAAS,kBAAI0K,EAAKvI,SAAS,CAAC5D,YAAY,OAC7GN,KAAKI,MAAME,WAAakB,EAAAC,EAAAC,cAAA,OAAKiL,MAAO,CAACuB,SAAU,WAAYC,OAAQ,MACnE3M,EAAAC,EAAAC,cAAA,OAAKoL,UAAU,cAAc/K,QAAS,kBAAI0K,EAAKvI,SAAS,CAAC5D,YAAY,OACnEkB,EAAAC,EAAAC,cAAC0M,EAAA,aAAD,CAAcC,MAAQrO,KAAKI,MAAMI,OAASsN,SAAU,SAAAQ,GAAC,OAAI7B,EAAKvI,SAAS,CAAC1D,OAAQ8N,EAAEC,UAC3E,MAEb/M,EAAAC,EAAAC,cAACgM,EAAA,EAAD,CAAKC,KAAM,GAAI3P,EAAQW,aACvB6C,EAAAC,EAAAC,cAACgM,EAAA,EAAD,CAAKC,KAAM,GACTnM,EAAAC,EAAAC,cAAA,OAAKoL,UAAU,gBAAgBH,MAAO,CAACU,WAAYrN,KAAKI,MAAMK,QAASsB,QAAS,kBAAI0K,EAAKvI,SAAS,CAAC3D,YAAY,OAC7GP,KAAKI,MAAMG,WAAaiB,EAAAC,EAAAC,cAAA,OAAKiL,MAAO,CAACuB,SAAU,WAAYC,OAAQ,MACnE3M,EAAAC,EAAAC,cAAA,OAAKoL,UAAU,cAAc/K,QAAS,kBAAI0K,EAAKvI,SAAS,CAAC3D,YAAY,OACnEiB,EAAAC,EAAAC,cAAC0M,EAAA,aAAD,CAAcC,MAAQrO,KAAKI,MAAMK,OAASqN,SAAU,SAAAQ,GAAC,OAAI7B,EAAKvI,SAAS,CAACzD,OAAQ6N,EAAEC,UAC3E,OAGf/M,EAAAC,EAAAC,cAACS,EAAA,EAAD,KAAUnE,EAAQS,QAClB+C,EAAAC,EAAAC,cAAC+L,EAAA,EAAD,CAAKX,UAAU,cACbtL,EAAAC,EAAAC,cAACgM,EAAA,EAAD,CAAKC,KAAM,GACR3N,KAAKI,MAAMxB,SAAW4C,EAAAC,EAAAC,cAAA,OAAKoL,UAAU,WAAWjL,IAAK7B,KAAKI,MAAMxB,WAAe,KAChF4C,EAAAC,EAAAC,cAAC8M,EAAA,EAAD,CACItM,KAAK,aACLuM,OAAO,YACP3B,UAAU,kBACV4B,gBAAgB,EAChBC,aAAc3O,KAAK4O,gBAEnBpN,EAAAC,EAAAC,cAACmN,EAAA,EAAD,KAAQrN,EAAAC,EAAAC,cAAC0L,EAAA,EAAD,CAAMhL,KAAK,YAAYpE,EAAQY,YAG7C4C,EAAAC,EAAAC,cAACgM,EAAA,EAAD,CAAKC,KAAM,GACR3N,KAAKI,MAAMvB,UAAY2C,EAAAC,EAAAC,cAAA,OAAKoL,UAAU,WAAWjL,IAAK7B,KAAKI,MAAMvB,YAAgB,KAClF2C,EAAAC,EAAAC,cAAC8M,EAAA,EAAD,CACItM,KAAK,aACLuM,OAAO,YACP3B,UAAU,kBACV4B,gBAAgB,EAChBC,aAAc3O,KAAK8O,iBAEnBtN,EAAAC,EAAAC,cAACmN,EAAA,EAAD,KAAQrN,EAAAC,EAAAC,cAAC0L,EAAA,EAAD,CAAMhL,KAAK,YAAYpE,EAAQa,cAI/C2C,EAAAC,EAAAC,cAACS,EAAA,EAAD,KAAUnE,EAAQkB,UAClBsC,EAAAC,EAAAC,cAAC+L,EAAA,EAAD,CAAKX,UAAU,YACbtL,EAAAC,EAAAC,cAACmN,EAAA,EAAD,CAAQ9M,QAAS/B,KAAKb,aAAcnB,EAAQmB,aAC5CqC,EAAAC,EAAAC,cAACmN,EAAA,EAAD,CAAQ9M,QAAS/B,KAAKZ,gBAAiBpB,EAAQoB,gBAC/CoC,EAAAC,EAAAC,cAACmN,EAAA,EAAD,CAAQ9M,QAAS/B,KAAKX,cAAerB,EAAQqB,cAC7CmC,EAAAC,EAAAC,cAACmN,EAAA,EAAD,CAAQ9M,QAAS/B,KAAKV,aAActB,EAAQsB,cAE9CkC,EAAAC,EAAAC,cAACS,EAAA,EAAD,MACAX,EAAAC,EAAAC,cAACqN,EAAA,EAAD,CAAOC,QAAShP,KAAKiB,YAAagO,WAAYjP,KAAKI,MAAMO,UAE3Da,EAAAC,EAAAC,cAACgM,EAAA,EAAD,CAAKC,KAAM,EAAGM,OAAQ,GACpBzM,EAAAC,EAAAC,cAACmN,EAAA,EAAD,CAAQzM,KAAK,UAAU8M,MAAM,QAAQ9B,KAAK,UAAUrL,QAAS/B,KAAKmP,iBAAkBnR,EAAQO,SAC5FiD,EAAAC,EAAAC,cAAA,OAAK0N,GAAG,UAAUzC,MAAO,CAACjH,OAAQ,IAAKrE,MAAO,IAAKgO,UAAW,MAC9D7N,EAAAC,EAAAC,cAAC+L,EAAA,EAAD,CAAKX,UAAU,YACbtL,EAAAC,EAAAC,cAACmN,EAAA,EAAD,CAAQ9M,QAAS/B,KAAKsP,YAAtB,QACA9N,EAAAC,EAAAC,cAAC8M,EAAA,EAAD,CACEtM,KAAK,aACLuM,OAAO,QACP3B,UAAU,kBACV4B,gBAAgB,EAChBC,aAAc3O,KAAKuP,cAEnB/N,EAAAC,EAAAC,cAACmN,EAAA,EAAD,cAGFrN,EAAAC,EAAAC,cAACmN,EAAA,EAAD,CAAQzM,KAAK,WAAb,wBAMVZ,EAAAC,EAAAC,cAAC8N,EAAA,EAAD,CACItO,MAAM,eACNuO,QAASzP,KAAKI,MAAMU,aACpB4O,KAAM1P,KAAK2P,cACXC,SAAU5P,KAAK6P,oBAEjBrO,EAAAC,EAAAC,cAAA,OAAK0N,GAAG,UAAUzC,MAAO,CAACtL,MAAO,IAAKqE,OAAQ,KAAM8D,IAAKxJ,KAAK8P,yBAC9DtO,EAAAC,EAAAC,cAAA,OAAKoL,UAAU,YACbtL,EAAAC,EAAAC,cAACmN,EAAA,EAAD,CAAQ9M,QAAS/B,KAAKlB,UAAWd,EAAQc,UACzC0C,EAAAC,EAAAC,cAACmN,EAAA,EAAD,CAAQ9M,QAAS/B,KAAKjB,UAAWf,EAAQe,UACzCyC,EAAAC,EAAAC,cAACmN,EAAA,EAAD,CAAQ9M,QAAS/B,KAAKhB,aAAchB,EAAQgB,aAC5CwC,EAAAC,EAAAC,cAACmN,EAAA,EAAD,CAAQ9M,QAAS/B,KAAKf,SAAUjB,EAAQiB,UAE1CuC,EAAAC,EAAAC,cAAA,SAAI1D,EAAQyB,eACZ+B,EAAAC,EAAAC,cAACS,EAAA,EAAD,MACAX,EAAAC,EAAAC,cAAC+L,EAAA,EAAD,KACEjM,EAAAC,EAAAC,cAACgM,EAAA,EAAD,CAAKC,KAAM,GACTnM,EAAAC,EAAAC,cAAA,sBAEFF,EAAAC,EAAAC,cAACgM,EAAA,EAAD,CAAKC,KAAM,GACTnM,EAAAC,EAAAC,cAACkM,EAAA,EAAD,CAAOC,MAAO7N,KAAKI,MAAMM,YAAaoN,SAAU,SAAAC,GAAC,OAAItB,EAAKvI,SAAS,CAACxD,YAAaqN,EAAEC,OAAOH,YAE5FrM,EAAAC,EAAAC,cAACgM,EAAA,EAAD,CAAKC,KAAM,IACTnM,EAAAC,EAAAC,cAAA,SAAI1D,EAAQwB,wBApmBRuQ,aC7DEC,QACW,cAA7BzM,OAAO0M,SAASC,UAEe,UAA7B3M,OAAO0M,SAASC,UAEhB3M,OAAO0M,SAASC,SAASC,MACvB,2DCZNC,IAAS9O,OAAOE,EAAAC,EAAAC,cAAC2O,EAAD,MAASrE,SAASsE,eAAe,SD2H3C,kBAAmBC,WACrBA,UAAUC,cAAcC,MAAMC,KAAK,SAAAC,GACjCA,EAAaC","file":"static/js/main.4620bcf9.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/logo.5d5d9eef.svg\";","import bindAll from 'lodash.bindall';\nimport LocalizedStrings from 'react-localization';\nimport { Alert, Row, Col, Button, Layout, Icon, Menu , Divider, Table, Radio, Popconfirm, Input, Modal, Upload } from 'antd';\nimport React, { Component } from 'react';\nimport Blockly from 'scratch-blocks';\n\nimport { SketchPicker } from 'react-color';\nimport logo from './logo.svg';\nimport './App.css';\nimport { string } from 'postcss-selector-parser';\n\nconst { SubMenu } = Menu;\nconst { Header, Content, Footer, Sider } = Layout;\nconst RadioGroup = Radio.Group;\n\nlet strings = new LocalizedStrings({\n  en:{\n    extID: \"Extension ID\",\n    extName: \"Extension Name\",\n    preview: \"Generate Preview\",\n    extdef: \"Extension Define\",\n    extimg: \"Extension Image\",\n    maincolor: \"Extension Color\",\n    secondcolor: \"Parameter Color\",\n    menuIcon: \"Menu Icon\",\n    blockIcon: \"Block Icon\",\n    addLabel: \"Add Label\",\n    addInput: \"Add String Parameter\",\n    addInputNum: \"Add Number Parameter\",\n    addBool: \"Add Boolean Parameter\",\n    addblock: \"Add Blocks\",\n    addBlockFun: \"Add Functional Block\",\n    addBlockOutput: \"Add Output Block\",\n    addBlockBool: \"Add Boolean Block\",\n    addBlockHat: \"Add Hat Block\",\n    delSure: \"delete this block?\",\n    uniqBlockId: \"* block ID should be unique\",\n    uniqBlockName: \"* block parameter names should be unique\",\n  },\n  zh: {\n    extID: \"插件ID\",\n    extName: \"插件名称\",\n    preview: \"生成预览\",\n    extdef: \"插件定义\",\n    extimg: \"插件图标\",\n    maincolor: \"插件颜色\",\n    secondcolor: \"变量颜色\",\n    menuIcon: \"菜单栏图标\",\n    blockIcon: \"方块图标\",\n    addLabel: \"添加文本\",\n    addInput: \"添加文本变量\",\n    addInputNum: \"添加数字变量\",\n    addBool: \"添加布尔变量\",\n    addblock: \"添加方块\",\n    addBlockFun: \"添加函数方块\",\n    addBlockOutput: \"添加输出方块\",\n    addBlockBool: \"添加布尔方块\",\n    addBlockHat: \"添加帽子方块\",\n    delSure: \"删除该方块?\",\n    uniqBlockId: \"* 积木ID需要全局唯一\",\n    uniqBlockName: \"* 积木参数名字需要唯一\",\n  }\n});\n\nconst emptyToolBox = `<xml style=\"display: none\">\n<category name=\"Test\" id=\"testExt\" colour=\"#0FBD8C\" secondaryColour=\"#0DA57A\" >\n</category>\n</xml>`;\n\nconst OUTPUT_SHAPE_HEXAGONAL = 1;\nconst OUTPUT_SHAPE_ROUND = 2;\nconst OUTPUT_SHAPE_SQUARE = 3;\n\nclass App extends Component {\n  constructor (props){\n    super(props);\n    this.state = {\n      collapsed: true,\n      extID: 'testExt',\n      extName: 'Test',\n      color1Pick: false,\n      color2Pick: false,\n      color1: '#0FBD8C',\n      color2: '#0DA57A',\n      menuIcon: null,\n      blockIcon: null,\n      editBlockID: 'newblock',\n      blocks: [],\n      menus: [],\n      addBlockType: '',\n      showMutation: false\n    }\n    bindAll(this, [\n      \"uploadMenuIcon\",\n      \"uploadBlockIcon\",\n      \"closeMutationModal\",\n      \"generatePreview\",\n      \"addBlockFun\",\n      \"addBlockOutput\",\n      \"addBlockBool\",\n      \"addBlockHat\",\n      \"addLabel\",\n      \"addInput\",\n      \"addInputNum\",\n      \"addBool\",\n      \"applyMutation\",\n      \"injectDeclareWorkspace\",\n      \"makeBlock\",\n      \"editBlock\",\n      \"deleteBlock\",\n      \"saveToJson\",\n      \"loadFromJson\",\n    ]);\n\n    this.blockColumn = [{\n      title: 'Op Code',\n      dataIndex: 'opcode',\n      key: 'opcode',\n      width: '20%',\n      render: text => <a href=\"javascript:;\">{text}</a>,\n    }, {\n      title: 'Preview',\n      dataIndex: 'svg',\n      key: 'svg',\n      render: (text, record) => (\n        <img src={`data:image/svg+xml;charset=utf-8,${text}`} />\n      )\n    }, {\n      title: 'Action',\n      key: 'action',\n      render: (text, record) => (\n        <span>\n          <a href=\"#\" onClick={() => this.editBlock(record.opcode)} >Edit {record.name}</a>\n          <Divider type=\"vertical\" />\n          <Popconfirm title={strings.delSure} onConfirm={() => this.deleteBlock(record.opcode)}>\n            <a href=\"#\">Delete</a>\n          </Popconfirm>\n        </span>\n      ),\n    }];\n  }\n\n  componentDidMount (){\n    this.previewWorkspace = Blockly.inject('preview', {\n      media: './media/',\n      toolbox: emptyToolBox,\n      zoom: {\n        startScale: 0.75\n      }\n    });\n\n    Blockly.Procedures.externalProcedureDefCallback = function (mutation, cb) {\n      console.log(\"externalProcedureDefCallback\");\n    }\n    this.previewWorkspace.getFlyout().setRecyclingEnabled(false);\n    window.ws = this.previewWorkspace;\n  }\n\n  uploadMenuIcon (file){\n    let reader = new FileReader();\n    const _this = this;\n    reader.onerror = function () {\n      console.warn(\"read image file error\")\n    };\n\n    reader.onload = function (ev) {\n      const dataUri = reader.result;\n      _this.setState({menuIcon: dataUri});\n    };\n    reader.readAsDataURL(file);\n  }\n\n  uploadBlockIcon (file){\n    let reader = new FileReader();\n    const _this = this;\n    reader.onerror = function () {\n      console.warn(\"read image file error\")\n    };\n\n    reader.onload = function (ev) {\n      const dataUri = reader.result;\n      _this.setState({blockIcon: dataUri});\n    };\n    reader.readAsDataURL(file);\n  }\n\n  generatePreview (){\n    const xmlParts = [];\n    this.previewWorkspace.clear();\n\n    const colorXML = `colour=\"${this.state.color1}\" secondaryColour=\"${this.state.color2}\"`;\n    let menuIconURI = '';\n    if (this.state.menuIcon) {\n        menuIconURI = this.state.menuIcon;\n    } else if (this.state.blockIcon) {\n        menuIconURI = this.state.blockIcon;\n    }\n    const blockJsons = [];\n    const menuIconXML = menuIconURI ?\n        `iconURI=\"${menuIconURI}\"` : '';\n    xmlParts.push(`<xml style=\"display: none\">`);\n    xmlParts.push(`<category name=\"${this.state.extName}\" id=\"${this.state.extID}\" ${colorXML} ${menuIconXML}>`);\n    xmlParts.push.apply(xmlParts, this.state.blocks.map(block => {\n      const extendedOpcode = `${this.state.extID}_${block.opcode}`;\n      let argIndex = 0;\n      const blockJSON = {\n        type: extendedOpcode,\n        category: this.state.extName,\n        colour: this.state.color1,\n        inputsInline: true,\n        colourSecondary: this.state.color2,\n        extensions: ['scratch_extension']\n      };\n      const iconURI = this.state.blockIcon;\n\n      if (iconURI) {\n          blockJSON.message0 = '%1 %2';\n          const iconJSON = {\n              type: 'field_image',\n              src: iconURI,\n              width: 40,\n              height: 40\n          };\n          const separatorJSON = {\n              type: 'field_vertical_separator'\n          };\n          blockJSON.args0 = [\n              iconJSON,\n              separatorJSON\n          ];\n          argIndex+=1;\n      }\n\n      blockJSON[`message${argIndex}`] = block.msg;\n      blockJSON[`args${argIndex}`] = block.args.map(arg => arg.json);\n\n\n      if (block.type === 'func'){\n        blockJSON.outputShape = OUTPUT_SHAPE_SQUARE;\n        blockJSON.nextStatement = null;\n        blockJSON.previousStatement = null;\n      } else if (block.type === 'output'){\n        blockJSON.outputShape = OUTPUT_SHAPE_ROUND;\n        blockJSON.output = \"String\";\n        blockJSON.checkboxInFlyout = true;\n      } else if (block.type === 'bool'){\n        blockJSON.output = \"Boolean\";\n        blockJSON.outputShape = OUTPUT_SHAPE_HEXAGONAL;\n      }\n\n      blockJsons.push(blockJSON);\n      const inputXML = block.args.map(arg => {\n        const inputList = [];\n        const placeholder = arg.placeholder.replace(/[<\"&]/, '_');\n        const shadowType = arg.shadowType;\n        const fieldType = arg.fieldType;\n        const defaultValue = arg.defaultValue || '';\n        inputList.push(`<value name=\"${placeholder}\">`);\n        if (shadowType) {\n          inputList.push(`<shadow type=\"${shadowType}\">`);\n          inputList.push(`<field name=\"${fieldType}\">${defaultValue}</field>`);\n          inputList.push('</shadow>');\n        }\n        inputList.push('</value>');\n        \n        return inputList.join('');\n      });\n      let blockXML = `<block type=\"${extendedOpcode}\">${inputXML.join('')}</block>`;\n      return blockXML;\n    }));\n    xmlParts.push('</category>');\n    xmlParts.push(`</xml>`);\n    Blockly.defineBlocksWithJsonArray(blockJsons);\n    console.log(\"extension\", xmlParts);\n    this.previewWorkspace.updateToolbox(xmlParts.join('\\n'));\n  }\n\n  closeMutationModal (){\n    this.declareWorkspace.clear();\n    this.setState({showMutation: false})\n  }\n\n  makeBlock (blockType, mutationText){\n    this.mutationRoot = this.declareWorkspace.newBlock('procedures_declaration');\n    // this.mutationRoot.setMovable(false);\n    this.mutationRoot.setDeletable(false);\n    this.mutationRoot.contextMenu = false;\n\n    // override default custom procedure insert\n    this.mutationRoot.addStringNumberExternal = function(isNum) {\n      Blockly.WidgetDiv.hide(true);\n      if (isNum){\n        this.procCode_ = this.procCode_ + ' %n';\n        this.displayNames_.push('X');\n      } else {\n        this.procCode_ = this.procCode_ + ' %s';\n        this.displayNames_.push('TXT');\n      }\n      this.argumentIds_.push(Blockly.utils.genUid());\n      this.argumentDefaults_.push('');\n      this.updateDisplay_();\n      this.focusLastEditor_();\n    };\n\n    // this.mutationRoot.domToMutation(this.props.mutator);\n    if (!mutationText){\n      mutationText = '<xml>' +\n        '<mutation' +\n        ' proccode=\"' + Blockly.Msg['PROCEDURE_DEFAULT_NAME'] + '\"' +\n        ' argumentids=\"[]\"' +\n        ' argumentnames=\"[]\"' +\n        ' argumentdefaults=\"[]\"' +\n        ' warp=\"false\">' +\n        '</mutation>' +\n        '</xml>';\n    }\n    const dom = Blockly.Xml.textToDom(mutationText).firstChild;\n    this.mutationRoot.domToMutation(dom);\n    this.mutationRoot.initSvg();\n    this.mutationRoot.render();\n    if (blockType === 'bool' || blockType === 'output'){\n      this.mutationRoot.setPreviousStatement(false, null);\n      this.mutationRoot.setNextStatement(false, null);\n      this.mutationRoot.setInputsInline(true);\n      if (blockType === 'output'){\n        this.mutationRoot.setOutputShape(Blockly.OUTPUT_SHAPE_ROUND);\n        this.mutationRoot.setOutput(true, 'Boolean');\n      } else {\n        this.mutationRoot.setOutputShape(Blockly.OUTPUT_SHAPE_HEXAGONAL);\n        this.mutationRoot.setOutput(true, 'Number');\n      }\n    } else {\n\n    }\n    const {x, y} = this.mutationRoot.getRelativeToSurfaceXY();\n    const dy = (360 / 2) - (this.mutationRoot.height / 2) - y;\n    const dx = (480 / 2) - (this.mutationRoot.width / 2) - x;\n    this.mutationRoot.moveBy(dx, dy);\n    window.mu = this.mutationRoot;\n  }\n\n  injectDeclareWorkspace (ref){\n    console.log(\"injectDeclareWorkspace\", ref);\n    this.blocks = ref;\n    const oldDefaultToolbox = Blockly.Blocks.defaultToolbox;\n    Blockly.Blocks.defaultToolbox = null;\n    this.declareWorkspace = Blockly.inject('declare', {\n      media: './media/'\n    });\n    Blockly.Blocks.defaultToolbox = oldDefaultToolbox;\n    \n    const _this = this;\n    this.declareWorkspace.addChangeListener(function(evt) {\n      // console.log(Object.getPrototypeOf(evt).type, evt);\n      if (_this.mutationRoot) {\n        _this.mutationRoot.onChangeFn();\n      }\n    });\n    this.makeBlock(this.state.addBlockType);\n  }\n\n  applyMutation (){\n    const svg = this.mutationRoot.getSvgRoot();\n    const bbox = svg.getBBox();\n    svg.removeAttribute('transform');\n    let xml = (new XMLSerializer).serializeToString(svg);\n    xml = `<svg id=\"src\" xmlns=\"http://www.w3.org/2000/svg\" width=\"${bbox.width}\" height=\"${bbox.height}\" >\n    ${xml}\n    </svg>`;\n\n    const mutation = this.mutationRoot.mutationToDom(true)\n    // console.log(mutation);\n    const argNames = JSON.parse(mutation.getAttribute('argumentnames'));\n    const args = [];\n\n    // parse proc code\n    let argCnt = 0;\n    const args0 = [];\n    let proccode = this.mutationRoot.getProcCode();\n    proccode = proccode.split(\" \");\n    for (let n=0; n<proccode.length; n++){\n      const p = proccode[n];\n      if (p === '%s'){ // string\n        const argName = argNames[argCnt];\n        const arg = {\n          placeholder: argName,\n          shadowType: 'text',\n          fieldType: 'TEXT',\n          json: {type: \"input_value\", name: argName}\n        }\n        proccode[n] = `%${argCnt+1}`;\n        args.push(arg);\n        argCnt+=1;\n      } else if (p === '%b'){ // bool\n        const argName = argNames[argCnt];\n        const arg = {\n          placeholder: argName,\n          // shadowType: 'text',\n          // fieldType: 'NUM'\n          check: 'Boolean',\n          json: {type: \"input_value\", name: argName, check: \"Boolean\"}\n        }\n        proccode[n] = `%${argCnt+1}`;\n        args.push(arg);\n        argCnt+=1;\n      } else if (p === '%n'){ // number\n        const argName = argNames[argCnt];\n        const arg = {\n          placeholder: argName,\n          shadowType: 'math_number',\n          fieldType: 'NUM',\n          json: {type: \"input_value\", name: argName}\n        }\n        proccode[n] = `%${argCnt+1}`;\n        args.push(arg);\n        argCnt+=1;\n      }\n    }\n\n    const msg = proccode.join(\" \");\n    const mutationText = `<xml>${Blockly.Xml.domToText(mutation)}</xml>`;\n    const newBlock = {\n      opcode: this.state.editBlockID,\n      svg: xml,\n      msg,\n      args,\n      mutationText: mutationText,\n      type: this.state.addBlockType\n    };\n    const blocks = [...this.state.blocks].filter(blk => blk.opcode !== this.state.editBlockID);\n    blocks.push(newBlock);\n    \n    this.setState({\n      showMutation: false,\n      blocks: blocks\n    });\n  }\n\n  addLabel (){\n    this.mutationRoot.addLabelExternal();\n  }\n  addInput (){\n    this.mutationRoot.addStringNumberExternal();\n  }\n  addInputNum (){\n    this.mutationRoot.addStringNumberExternal(true);\n  }\n  addBool (){\n    this.mutationRoot.addBooleanExternal();\n  }\n  addBlockFun (){\n    this.setState({\n      showMutation: true,\n      addBlockType: 'func',\n    });\n    if (this.declareWorkspace){\n      this.declareWorkspace.clear();\n      this.makeBlock();\n    }\n\n  }\n\n  addBlockOutput (){\n    this.setState({\n      addBlockType: 'output',\n      showMutation: true\n    });\n    if (this.declareWorkspace){\n      this.declareWorkspace.clear();\n      this.makeBlock('output');\n    }\n  }\n\n  addBlockBool (){\n    this.setState({\n      addBlockType: 'bool',\n      showMutation: true\n    });\n    if (this.declareWorkspace){\n      this.declareWorkspace.clear();\n      this.makeBlock('bool');\n\n    }\n\n  }\n\n  addBlockHat (){\n    this.setState({\n      addBlockType: 'hat',\n      showMutation: true\n    });\n    if (this.declareWorkspace){\n      this.declareWorkspace.clear();\n      this.makeBlock('hat');\n    }\n\n  }\n\n  editBlock (opcode){\n    const block = this.state.blocks.filter(blk => blk.opcode === opcode);\n    if (block && block.length == 1){\n      this.declareWorkspace.clear();\n      this.makeBlock(block[0].type, block[0].mutationText);\n      this.setState({\n        showMutation: true,\n        addBlockType: block[0].type\n      });\n    }\n  }\n\n  deleteBlock (opcode){\n    const blocks = [...this.state.blocks].filter(blk => blk.opcode !== opcode);\n    this.setState({blocks});\n  }\n\n  saveToJson (){\n    const dataStr = \"data:text/json;charset=utf-8,\" + encodeURIComponent(JSON.stringify(this.state, 2));\n    const downloadAnchorNode = document.createElement('a');\n    downloadAnchorNode.setAttribute(\"href\",     dataStr);\n    downloadAnchorNode.setAttribute(\"download\", this.state.extID + \".json\");\n    document.body.appendChild(downloadAnchorNode); // required for firefox\n    downloadAnchorNode.click();\n    downloadAnchorNode.remove();\n  }\n\n  loadFromJson (file){\n    if (file){\n      let reader = new FileReader();\n      const _this = this;\n      reader.onerror = function () {\n          console.warn(\"read image file error\")\n      };\n      reader.onload = ev => {\n        this.setState(Object.assign({},\n          JSON.parse(reader.result)\n        ))\n      }\n      reader.readAsText(file);\n    }\n  }\n\n  render() {\n    return (\n      <Layout style={{height: '100vh'}}>\n        <Sider\n          trigger={null}\n          collapsible\n          collapsed={this.state.collapsed}\n        >\n          <div className=\"logo\" />\n          <Menu theme=\"dark\" mode=\"inline\" defaultSelectedKeys={['1']}>\n            <Menu.Item key=\"1\">\n              <Icon type=\"plus\" />\n              <span>New Extension</span>\n            </Menu.Item>\n          </Menu>\n        </Sider>\n        <Layout>\n          <Header style={{ background: '#fff', padding: 0 }}>\n            <Icon\n              className=\"trigger\"\n              type={this.state.collapsed ? 'menu-unfold' : 'menu-fold'}\n              onClick={() => this.setState({collapsed: !this.state.collapsed})}\n            />\n          </Header>\n          <Content style={{\n            margin: '24px 16px', padding: 24, background: '#fff', minHeight: 280,\n          }}\n          >\n            <Row>\n              <Col span={14}>\n                <Divider>{strings.extdef}</Divider>\n                <Row className=\"config-row\">\n                  <Col span={2}>\n                    <p>{strings.extID}</p>\n                  </Col>\n                  <Col span={3}>\n                    <Input value={this.state.extID} onChange={e => this.setState({extID: e.target.value})} />\n                  </Col>\n                  <Col span={2} offset={1}>\n                    <p>{strings.extName}</p>\n                  </Col>\n                  <Col span={3}>\n                    <Input value={this.state.extName} onChange={e => this.setState({extName: e.target.value})} />\n                  </Col>\n                </Row>\n                <Row className=\"config-row\">\n                  <Col span={2}>{strings.maincolor}</Col>\n                  <Col span={3}>\n                    <div className=\"color-display\" style={{background: this.state.color1}} onClick={()=>this.setState({color1Pick: true})} />\n                    { this.state.color1Pick ? <div style={{position: \"absolute\", zIndex: '2'}}>\n                      <div className=\"color-cover\" onClick={()=>this.setState({color1Pick: false})}/>\n                        <SketchPicker color={ this.state.color1 } onChange={c => this.setState({color1: c.hex})} />\n                      </div> : null }\n                  </Col>\n                  <Col span={2}>{strings.secondcolor}</Col>\n                  <Col span={3}>\n                    <div className=\"color-display\" style={{background: this.state.color2}} onClick={()=>this.setState({color2Pick: true})} />\n                    { this.state.color2Pick ? <div style={{position: \"absolute\", zIndex: '2'}}>\n                      <div className=\"color-cover\" onClick={()=>this.setState({color2Pick: false})}/>\n                        <SketchPicker color={ this.state.color2 } onChange={c => this.setState({color2: c.hex})} />\n                      </div> : null }\n                  </Col>\n                </Row>\n                <Divider>{strings.extimg}</Divider>\n                <Row className=\"config-row\">\n                  <Col span={4}>\n                    {this.state.menuIcon ? <img className=\"icon-img\" src={this.state.menuIcon} /> : null}\n                    <Upload\n                        name=\"projheader\"\n                        accept=\".png,.svg\"\n                        className=\"header-uploader\"\n                        showUploadList={false}\n                        beforeUpload={this.uploadMenuIcon}\n                    >\n                        <Button><Icon type=\"picture\"/>{strings.menuIcon}</Button>\n                    </Upload>\n                  </Col>\n                  <Col span={4}>\n                    {this.state.blockIcon ? <img className=\"icon-img\" src={this.state.blockIcon} /> : null}\n                    <Upload\n                        name=\"projheader\"\n                        accept=\".png,.svg\"\n                        className=\"header-uploader\"\n                        showUploadList={false}\n                        beforeUpload={this.uploadBlockIcon}\n                    >\n                        <Button><Icon type=\"picture\"/>{strings.blockIcon}</Button>\n                    </Upload>\n                  </Col>\n                </Row>\n                <Divider>{strings.addblock}</Divider>\n                <Row className=\"btn-wrap\">\n                  <Button onClick={this.addBlockFun}>{strings.addBlockFun}</Button>\n                  <Button onClick={this.addBlockOutput}>{strings.addBlockOutput}</Button>\n                  <Button onClick={this.addBlockBool}>{strings.addBlockBool}</Button>\n                  <Button onClick={this.addBlockHat}>{strings.addBlockHat}</Button>\n                </Row>\n                <Divider></Divider>\n                <Table columns={this.blockColumn} dataSource={this.state.blocks} />\n              </Col>\n              <Col span={8} offset={1}>\n                <Button type=\"primary\" shape=\"round\" icon=\"picture\" onClick={this.generatePreview}>{strings.preview}</Button>\n                <div id=\"preview\" style={{height: 600, width: 480, marginTop: 10}}></div>\n                <Row className=\"btn-wrap\">\n                  <Button onClick={this.saveToJson}>Save</Button>\n                  <Upload \n                    name=\"jsonUpload\"\n                    accept=\".json\"\n                    className=\"header-uploader\"\n                    showUploadList={false}\n                    beforeUpload={this.loadFromJson}\n                  >\n                    <Button>Open</Button>\n                  </Upload>\n                  \n                  <Button type=\"primary\">Export index.js</Button>\n                </Row>\n              </Col>\n            </Row>\n          </Content>\n        </Layout>\n        <Modal\n            title=\"Modify Block\"\n            visible={this.state.showMutation}\n            onOk={this.applyMutation}\n            onCancel={this.closeMutationModal}\n        >\n          <div id=\"declare\" style={{width: 480, height: 360}} ref={this.injectDeclareWorkspace}></div>\n          <div className=\"btn-wrap\">\n            <Button onClick={this.addLabel}>{strings.addLabel}</Button>\n            <Button onClick={this.addInput}>{strings.addInput}</Button>\n            <Button onClick={this.addInputNum}>{strings.addInputNum}</Button>\n            <Button onClick={this.addBool}>{strings.addBool}</Button>\n          </div>\n          <p>{strings.uniqBlockName}</p>\n          <Divider />\n          <Row>\n            <Col span={3}>\n              <p>Block ID</p>\n            </Col>\n            <Col span={8}>\n              <Input value={this.state.editBlockID} onChange={e => this.setState({editBlockID: e.target.value})} />\n            </Col>\n            <Col span={12}>\n              <p>{strings.uniqBlockId}</p>\n            </Col>\n          </Row>\n        </Modal>\n      </Layout>\n    );\n  }\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read http://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}